---
title: "First Draft of Tejon Analysis"
author: "sbsambado"
date: "9/3/2020"
output: html_document
---

Data were collected by the Young lab at UCSB.

Data come from Tejon Ranch in southern California. 

Experimental design:
  3 Sites that vary in elevation
    Arid (lowest), Intermediate (middle), Mesic (highest)
      block desing: 1, 2, 3
  
  Within each site there are 3 Plot types that vary in animal exclusion
    Open (no exclusion), Partial (excludes non-native larger animals), Total (only smaller animals)
    

  
  
Data include:
  Tick drags 
    across : Years (2016 - 2019) and months
    species : I. pacificus, D. occidentalis, D. variabiles, Unknown
    total ticks
  
  Mammal trapping
    across : Years (2018, 2019) and months
    species : peromyscus, and limited non-peromysucs 
    

Notes : 
- if < 1 animal for species, it was placed in the NA category (i.e. TEBO) 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(readr)
library(ggpubr)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(plyr)
library(car)
library(multcomp)
library(multcompView)
library(reshape2)
library(stringr)
library(car)
library(psych)
library(knitr)
library(nlme)
library(lme4)
library(kableExtra)
library(MASS)
library(grid)
library(vegan)
library(devtools)
library(ggfortify)
devtools::install_github('gavinsimpson/ggvegan')

clean_background <- theme(plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("white"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12),
        legend.key = element_rect("white"))

plotcolor = c('darkseagreen1','darkseagreen3','darkseagreen4')
sitecolor = c('red4','red2','red')

```

Tick Analysis
- imported data from sheet called 'tejon_all_tick_drags_09022020.csv'
```{r data importing and organizing}
# full dataset
alldrag <- read.csv("~/Desktop/tejon_all_tick_drags_09022020.csv")

# break up by site, no other filter
intermediate <- filter(alldrag, Site == 'Intermediate')
mesic <- filter(alldrag, Site == 'Mesic')
arid <- filter(alldrag, Site == 'Arid')

# transform variables into specific types of data
alldrag$Month <- factor(alldrag$Month, 
                        levels = c('January', 'February', 'March',
                                   'April', 'May', 'June', 'July',
                                   'August', 'September', 'October',
                                   'November', 'December'))

alldrag$Site <- factor(alldrag$Site,
                       levels = c('Arid', 'Intermediate', 'Mesic'))

alldrag$Plot <- factor(alldrag$Plot,
                       levels = c('Open', 'Partial', 'Total'))

alldrag$Year <- factor(alldrag$Year,
                       levels = c('2016', '2017', '2018', '2019'))
```


Plots
one = Total ticks per Sampling by  Site no outliers 
two = Total ticks per Sampling by  Site with outliers

Does site type (X) impact total tick abundance (Y)?
```{r total tick abundance per sampling ~ site}

## represents average total ticks collected across the years and sitess

## no outliers
one <- ggplot(data = alldrag, aes(x = Site, y = Total_ticks))+
  geom_boxplot(fill = sitecolor, outlier.color = 'black', outlier.shape = NA)+
  clean_background+
  coord_cartesian(ylim = c(0,16))+
  xlab('Site Types') + ylab('Total Ticks per Sampling')+
  ggtitle('Total Ticks per Sampling by Site \n no outliers')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))

## with outliers
two <- ggplot(data = alldrag, aes(x = Site, y = Total_ticks))+
  geom_boxplot(fill = sitecolor, outlier.color = 'black', outlier.shape = 1)+
  clean_background+
  xlab('Site Types') + ylab('Total Ticks per Sampling')+
  ggtitle('Total ticks per Sampling by Site')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold')) 


one
two

```

Plots
three = Total ticks per Sampling by  Plot no outliers 
four = Total ticks per Sampling by  Plot with outliers


Does plot type (X) impact total tick abundance (Y)?
```{r total tick abundance per sampling ~ plot}

## represents average total ticks collected across the years and plots

## no outliers
three <- ggplot(data = alldrag, aes(x = Plot, y = Total_ticks))+
  geom_boxplot(fill = plotcolor, outlier.color = 'black', outlier.shape = NA)+
  clean_background+
  coord_cartesian(ylim = c(0,13))+
  xlab('Plot Types') + ylab('Total Ticks per Sampling')+
  ggtitle('Total Ticks per Sampling by Plot \n no outliers')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))

## with outliers
four <- ggplot(data = alldrag, aes(x = Plot, y = Total_ticks))+
  geom_boxplot(fill = plotcolor, outlier.color = 'black', outlier.shape = 1)+
  clean_background+
  xlab('Plot Types') + ylab('Total Ticks per Sampling')+
  ggtitle('Total ticks per Sampling by Plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold')) 


three
four

```


Plots
five = Total ticks per sampling across month by site Arid (no outliers)
six = Total ticks per sampling across month by site Intermediate (no outliers)
seven = Total ticks per sampling across month by site Mesic (no outliers)
eight = compares total ticks per sampling across month by all sites (this is messy, but wanted a quick side by side picture)
nine = Total ticks per sampling across month by site Arid (no outliers)
ten = Total ticks per sampling across month by site Intermediate (no outliers)
eleven = Total ticks per sampling across month by site Mesic (no outliers)

How does total tick abundance vary by month at each site? 
```{r total tick abundance across month by site}
## no outliers
five <- ggplot(data = arid, 
               aes(x = Month, y = Total_ticks,
                   fill = Plot), group = Plot)+
  geom_boxplot(outlier.shape = NA)+
  scale_color_identity()+
  facet_wrap(~Plot, ncol = 3)+
  clean_background +
  coord_cartesian(ylim = c(0,13))+
  xlab('Months') + ylab('Total ticks per sampling ')+
  ggtitle('Arid : Total ticks per sampling by plot \n no outliers')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))

six <- ggplot(data = intermediate, 
               aes(x = Month, y = Total_ticks,
                   fill = Plot), group = Plot)+
  geom_boxplot(outlier.shape = NA)+
  scale_color_identity()+
  facet_wrap(~Plot, ncol = 3)+
  clean_background +
  coord_cartesian(ylim = c(0,40))+
  xlab('Months') + ylab('Total ticks per sampling ')+
  ggtitle('Intermediate : Total ticks per sampling by plot \n no outliers')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))

seven <- ggplot(data = mesic, 
               aes(x = Month, y = Total_ticks,
                   fill = Plot), group = Plot)+
  geom_boxplot(outlier.shape = NA)+
  scale_color_identity()+
  facet_wrap(~Plot, ncol = 3)+
  clean_background +
  coord_cartesian(ylim = c(0,20))+
  xlab('Months') + ylab('Total ticks per sampling ')+
  ggtitle('Mesic : Total ticks per sampling by plot \n no outliers')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))

## try to arrange in a visual way
eight<- ggarrange(five +rremove('xlab') +rremove('ylab') + rremove('legend'),
                  six +rremove('xlab') +rremove('ylab') + rremove('legend'), 
                  seven +rremove('xlab') +rremove('ylab')+ rremove('legend'),
                  ncol = 3)
annotate_figure(eight,
                top = text_grob('Total Ticks by Month',
                                face = 'bold', size = 16,
                                color = 'red'))

## Outliers
nine <- ggplot(data = arid, 
               aes(x = Month, y = Total_ticks,
                   fill = Plot), group = Plot)+
  geom_boxplot(outlier.shape = 1)+
  scale_color_identity()+
  facet_wrap(~Plot, ncol = 3)+
  clean_background +
  coord_cartesian(ylim = c(0,45))+
  xlab('Months') + ylab('Total ticks per sampling ')+
  ggtitle('Arid : Total ticks per sampling by plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))

ten <- ggplot(data = intermediate, 
               aes(x = Month, y = Total_ticks,
                   fill = Plot), group = Plot)+
  geom_boxplot(outlier.shape = 1)+
  scale_color_identity()+
  facet_wrap(~Plot, ncol = 3)+
  clean_background +
  coord_cartesian(ylim = c(0,50))+
  xlab('Months') + ylab('Total ticks per sampling ')+
  ggtitle('Intermediate : Total ticks per sampling by plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))

eleven <- ggplot(data = mesic, 
               aes(x = Month, y = Total_ticks,
                   fill = Plot), group = Plot)+
  geom_boxplot(outlier.shape = 1)+
  scale_color_identity()+
  facet_wrap(~Plot, ncol = 3)+
  clean_background +
  coord_cartesian(ylim = c(0,20))+
  xlab('Months') + ylab('Total ticks per sampling ')+
  ggtitle('Mesic : Total ticks per sampling by plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))


five
six
seven
nine
ten
eleven
```

Plots

twelve = total tick abundance per sampling by site and plot type
```{r tick abundance across sites with plot type fill}
twelve <-ggplot(data = alldrag,
       aes(x = Site, y = Total_ticks,
           fill = Plot))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  theme_classic()+
  xlab('Site') + ylab('Total tick abundance per sampling')+
  ggtitle('Total tick abundance per sampling by site and plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) 

twelve
```

Plots

thirteen = Total tick abundance per sampling by year by plot type
```{r tick abundance by year}

thirteen <- ggplot(data = arid,
                   aes(x = Year, y = Total_ticks,
                       fill = Plot))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Year') + ylab('Total tick abundance per sampling')+
  ggtitle('Total tick abundance per sampling by year and plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) 

thirteen
```


Need to fix this section with some summary stats, wilcox test

######### is there a trend with total ticks across the years? ######### 
plot(alldrag$Total_ticks ~ alldrag$Year)
fit<-lm(alldrag$Total_ticks ~ alldrag$Year)
abline(fit, col = 'green', lwd = 3)

## ^^ very very small linear increase

```{r basic stats}

########## what is the distribution?  #########
hist(alldrag$Total_ticks, breaks = 5,
     xlab = 'Total ticks')
par(mfrow = c(3,1))
hist(alldrag$Total_ticks[alldrag$Site == 'Arid'],
     xlab = 'Total ticks', main = 'Arid')
hist(alldrag$Total_ticks[alldrag$Site == 'Intermediate'],
     xlab = 'Total ticks', main = 'Intermediate')
hist(alldrag$Total_ticks[alldrag$Site == 'Mesic'],
     xlab = 'Total ticks', main = 'Mesic')

# ^^^^^^ Possion distribution, not surprised


########## # can we log transform? ########### 

alldrag$log_total_ticks <- log(alldrag$Total_ticks + 1)
#view(alldrag)

hist(alldrag$log_total_ticks,
     xlab = 'Total ticks')
par(mfrow = c(3,1))
hist(alldrag$log_total_ticks[alldrag$Site == 'Arid'],
     xlab = 'Total ticks', main = 'Arid')
hist(alldrag$log_total_ticks[alldrag$Site == 'Intermediate'],
     xlab = 'Total ticks', main = 'Intermediate')
hist(alldrag$log_total_ticks[alldrag$Site == 'Mesic'],
     xlab = 'Total ticks', main = 'Mesic')

## ^^^ helped with mesic distrubution but not much else

########### how common are certain tick counts?  ############## 

## cumulative density function plot of abundance of ticks ######### 
emp_cdf <- ecdf(alldrag$Total_ticks)
plot(emp_cdf, 
     col = 'red')

## ^^ most total tick counts are less than 10, 80% are < 9 ticks total

########### is there a difference of total ticks between mesic and arid? ########### 

####### shapiro-wilk test

# H0 : data are normal
# p < 0.5 data are not normal

shapiro.test(alldrag$Total_ticks) # severly not normal, p < 2.2e-16
qqPlot(alldrag$Total_ticks) # data is not normal, do not run a t-test, like maybe CTL but no


####### lavene's test
# H0 : variance between 2 groups are equal
# if you reject lavene's test use Welch's t-test


# let's create two groups, arid or mesic

aridd <- subset(alldrag, Site == 'Arid')
mesicc <- subset(alldrag, Site == 'Mesic')

t.test(aridd$Total_ticks, mesicc$Total_ticks)

## ^ p = 0.0008068, p < 0.05, 95% does not contain 0, therefore we reject our H0 and say there is a significant difference between the groups



```


-check to see if CTL will allow me to run ANOVAS since assumptions are not met

Tukey test is a single-step multiple comparison procedure and statistical test. It is a post-hoc analysis, which means that it is used in conjunction with an ANOVA

Tukey-Krame allows to find means of a factor that are significantly different from each other, comparing all possible pairs of means with a t-test like method


Factor(s)
  1. Site
    levels = Arid, Intermediate, Mesic
  2. Plot
    levels = Open, Partial, Total
  3. Year
    levels = 2016, 2017, 2018, 2019
  4. Month (probably less ideal way to do this)
    levels = January through December 
    
    
Plots

fouteen = ANOVA site
fifteen = ANOVA plot
sixteen = ANOVA year
seventeen = ANOVA month
```{r ANOVA for site}

############### ####################  SITE  ############ #######################
# H0 : all group means are equal
# HA : at least 1 mean is not equal

boxplot(Total_ticks ~ Site, 
        data = alldrag)
## ^ lots of outliers

with(alldrag, hist(Total_ticks[Site == 'Arid']))
with(alldrag, hist(Total_ticks[Site == 'Intermediate']))
with(alldrag, hist(Total_ticks[Site == 'Mesic']))

# run an ANOVA
site1 <- aov(Total_ticks ~ Site, 
        data = alldrag)
par(mfrow = c(2,2))
plot(site1)

# check residuals
res = site1$residuals
shapiro.test(res) # p << 0.05 so data not normal
hist(res)
leveneTest(Total_ticks ~ Site, 
        data = alldrag) # p << 0.05 so variances are not equal

summary(site1)
# Fvalue = 39.52
# p < 2e-16 , reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(site1)

# let's do this in a visual way
Post_hoc <-glht(site1, linfct = mcp(Site = 'Tukey'))
summary(Post_hoc)

############### ^ intermediate is significantly different (p < 0.001)


confint(Post_hoc) # pairwise test
cld(Post_hoc) # arid & mesic = a ; intermediate = b , so intermediate is different than arid & mesic
plot(Post_hoc) # plot 95% CIs

############ ^^^^ the mean of total tick counts is significantly different in Intermediate than Mesic and Arid!
# Intermediate has a different letter & CIs don't overlap with 0 & p-values are significant

# Site
fourteen <- ggplot(data = alldrag,
       aes(x = Site, y = Total_ticks,
           fill = Site))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  theme_classic()+
  xlab('Site') + ylab('Total Ticks')+
  ggtitle('Total Ticks by Site')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = 1.8,
           size = 9, color = 'red') +
  annotate('text', label = 'b', 
           x = 2, y = 5,
           size = 9, color = 'red') +
    annotate('text', label = 'a', 
           x = 3, y = 2.5,
           size = 9, color = 'red')


```

```{r ANOVA for plot}
######################################## PLOT  ########################################  

# H0 : all group means are equal
# HA : at least 1 mean is not equal

boxplot(Total_ticks ~ Year, 
        data = alldrag)
## ^ lots of outliers

#with(alldrag, hist(Total_ticks[Site == 'Arid']))
#with(alldrag, hist(Total_ticks[Site == 'Intermediate']))
#with(alldrag, hist(Total_ticks[Site == 'Mesic']))


plot1 <- aov(Total_ticks ~ Plot, 
        data = alldrag)
par(mfrow = c(2,2))
plot(plot1)

# check residuals
resp = year1$residuals
shapiro.test(resp) # p << 0.05 so data not normal
hist(resp)
#leveneTest(Total_ticks ~ Year, 
        #data = alldrag) # p << 0.05 so variances are not equal


summary(plot1)
# Fvalue = 25.98 
# p < 8.33e-12  , reject H0 and conclude that 1 plot is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(plot1)

# let's do this in a visual way
Post_hocp <-glht(plot1, linfct = mcp(Plot = 'Tukey'))
summary(Post_hocp)

confint(Post_hocp) # pairwise test
cld(Post_hocp) # different letters are different from each other open is different than partial & total!
plot(Post_hocp) # plot 95% CIs

########################  ^^^^ Open is significantly different

# Open has a different letter & CIs don't overlap with 0 & p-values are significant

# Plot
fifteen <-ggplot(data = alldrag,
       aes(x = Plot, y = Total_ticks,
           fill = Plot))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  theme_classic()+
  xlab('Plot') + ylab('Total Ticks')+
  ggtitle('Total Ticks by Plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = 1.6,
           size = 9, color = 'red') +
  annotate('text', label = 'b', 
           x = 2, y = 3.4,
           size = 9, color = 'red') +
    annotate('text', label = 'b', 
           x = 3, y = 4.3,
           size = 9, color = 'red')


```

```{r ANOVA for year}
################################################## YEAR  ######################################## 

# H0 : all group means are equal
# HA : at least 1 mean is not equal

boxplot(Total_ticks ~ Year, 
        data = alldrag)
## ^ lots of outliers

#with(alldrag, hist(Total_ticks[Site == 'Arid']))
#with(alldrag, hist(Total_ticks[Site == 'Intermediate']))
#with(alldrag, hist(Total_ticks[Site == 'Mesic']))


year1 <- aov(Total_ticks ~ Year, 
        data = alldrag)
par(mfrow = c(2,2))
plot(year1)

# check residuals
resy = year1$residuals
shapiro.test(resy) # p << 0.05 so data not normal
hist(resy)
#leveneTest(Total_ticks ~ Year, 
        #data = alldrag) # p << 0.05 so variances are not equal

summary(year1)
# Fvalue = 21.63
# p  = 8.33e-12, p < 0.001 reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)

# need to transform year into factor to run TukeyHSD
class(alldrag$Year) # integer
alldrag$Year = as.factor(alldrag$Year)
class(alldrag$Year) #factor

TukeyHSD(year1)

# let's do this in a visual way
Post_hocy <-glht(year1, linfct = mcp(Year = 'Tukey'))
summary(Post_hocy)

confint(Post_hocy) # pairwise test
cld(Post_hocy) # different letters are different from each other
plot(Post_hocy) # plot 95% CIs

#### ^^^^ 2017 & 2018 similar 'c', 2016 different 'a', 2019 different 'b'

# 2016, 2019, 2017 & 2018 has a different letter & CIs don't overlap with 0 & p-values are significant


# Plot
sixteen<- ggplot(data = alldrag,
       aes(x = Year, y = Total_ticks,
           fill = Year))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('lightblue1','lightblue2','lightblue3','lightblue4'))+
  theme_classic()+
  xlab('Year') + ylab('Total Ticks')+
  ggtitle('Total Ticks by Year')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = .5,
           size = 9, color = 'red') +
  annotate('text', label = 'c', 
           x = 2, y = 3.93,
           size = 9, color = 'red') +
    annotate('text', label = 'c', 
           x = 3, y = 3.9,
           size = 9, color = 'red')+
   annotate('text', label = 'b', 
           x = 4, y = 2.72,
           size = 9, color = 'red')




```

```{r ANOVA for month}
################### ########## # MONTH  ############# ########## #######

# H0 : all group means are equal
# HA : at least 1 mean is not equal

boxplot(Total_ticks ~ Month, 
        data = alldrag)
## ^ lots of outliers

#with(alldrag, hist(Total_ticks[Site == 'Arid']))
#with(alldrag, hist(Total_ticks[Site == 'Intermediate']))
#with(alldrag, hist(Total_ticks[Site == 'Mesic']))


month1 <- aov(Total_ticks ~ Month, 
        data = alldrag)
par(mfrow = c(2,2))
plot(month1)

# check residuals
resm = month1$residuals
shapiro.test(resm) # p << 0.05 so data not normal
hist(resm)
leveneTest(Total_ticks ~ Month, 
        data = alldrag) # p << 0.05 so variances are not equal

summary(month1)
# Fvalue = 24.85
# p < 2e-16 , reject H0 and conclude that 1 month is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(month1)

par(mfrow = c(1,1))
# let's do this in a visual way
Post_hocm <-glht(month1, linfct = mcp(Month = 'Tukey'))
summary(Post_hocm)

confint(Post_hocm) # pairwise test
cld(Post_hocm) # different letters are different from each other
plot(Post_hocm) # plot 95% CIs

#### ^^^^ Months (May?) is significantly different, this is kinda  poor way of analyzing months, maybe group by season but that doesn't say much either

seventeen <- ggplot(data = alldrag,
       aes(x = Month, y = Total_ticks))+
  geom_bar(stat = 'summary', fun.y = 'mean', fill = 'grey')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  theme_classic()+
  xlab('Month') + ylab('Total Ticks')+
  ggtitle('Total Ticks by Month')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = .5,
           size = 7, color = 'red') +
  annotate('text', label = 'ab', 
           x = 2, y = .7,
           size = 7, color = 'red') +
    annotate('text', label = 'ac', 
           x = 3, y = 3.2,
           size = 7, color = 'red')+
   annotate('text', label = 'e', 
           x = 4, y = 6.6,
           size = 7, color = 'red') +
  annotate('text', label = 'de', 
           x = 5, y = 6.4,
           size = 7, color = 'red') +
  annotate('text', label = 'cd', 
           x = 6, y = 4.7,
           size = 7, color = 'red') +
    annotate('text', label = 'ab', 
           x = 7, y = 2.1,
           size = 7, color = 'red')+
   annotate('text', label = 'a', 
           x = 8, y = .5,
           size = 7, color = 'red')+
   annotate('text', label = 'a', 
           x = 9, y = .5,
           size = 7, color = 'red')+ 
  annotate('text', label = 'bc', 
           x = 10, y = 3.6,
           size = 7, color = 'red')+
  annotate('text', label = 'ac', 
           x = 11, y = 3.2,
           size = 7, color = 'red')+
  annotate('text', label = 'a', 
           x = 12, y = .5,
           size = 7, color = 'red')


```

##What are good predictors (X) of total tick abundance (Y)?

Ran *generalized linear models* because data breaks assumptions of normality. Used family poisson because of count data.

Object *'tickmodels'* is table of df, AIC, BIC, variables used in glm models
- lowest AIC: all 4 variables (Site, Year, Plot, Month)
- lowest AIC within single predictors = Year
  Year AIC = 10496
  Site AIC = 10665
  Plot AIC = 10871

tick1 - tick7 glm models

Graph
  eighteen = kable table with df, AIC, BIC, variables
  nineteen = table with p values

```{r glm for tick data}

tick1 <- glm(Total_ticks ~ Year, 
               data = alldrag,
             family = 'poisson')

tick2 <- glm(Total_ticks ~ Site, 
               data = alldrag,
              family = 'poisson')

tick3 <- glm(Total_ticks ~ Plot, 
               data = alldrag,
              family = 'poisson')

tick4 <- glm(Total_ticks ~ Month, 
               data = alldrag,
              family = 'poisson')

tick5 <- glm(Total_ticks ~ Site + Year, 
               data = alldrag,
              family = 'poisson')

tick6 <- glm(Total_ticks ~ Site + Year + Plot, 
               data = alldrag,
              family = 'poisson')

tick7 <- glm(Total_ticks ~ Site + Year + Plot + Month, 
               data = alldrag,
              family = 'poisson')


# calculate AIC of each model

tickresults <- AIC(tick1, tick2, tick3,
                    tick4, tick5, tick6,
                   tick7)

# add other metrics to table
tickmodels <- list(tick1, tick2, tick3,
                    tick4, tick5, tick6,
                   tick7) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
tickresults$BIC <- sapply(tickmodels, BIC) # add column for BIC

tick_model_summary <- lapply(tickmodels, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(tickmodels)) {
  tickresults$rsq[i] <- tick_model_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  tickresults$adj_rsq[i] <- tick_model_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
tickresults$variables <- c('Year','Site', 'Plot', 'Month', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

# make a nice table!
tickmodels <-kable(tickresults, digits = 2, align = 'c') %>%
  kable_styling()

eighteen <-tickmodels

nineteen <- export_summs(tick1, tick2, tick3, scale = TRUE)
#min(tickresults$AIC)

```


Ran *generalized linear mixed-effect models* because data breaks assumptions of normality. Used family poisson because of count data. *Incorporating mixed-effects.*

Object *'tick_glmm_models'* is table of df, AIC, BIC, variables used in glmm models
- lowest AIC: all 4 variables (Site, Year, Plot, Month) *[same as glm models]*
- lowest AIC within single predictors = Year *[same as glm models]*
  Year AIC = 9958 *[lower AIC than glm models]*
  Site AIC = 10127 *[lower AIC than glm models]*
  Plot AIC = 10333 *[lower AIC than glm models]*

tick8 - tick14 glm models

Graph
  twenty = kable table with df, AIC, BIC, variables
  twentyone = table with p values

```{r glmm tick models}

tick8 <- glmer(Total_ticks ~ Year + (1|Block), 
               data = alldrag,
             family = poisson(link = 'log'))

tick9 <- glmer(Total_ticks ~ Site + (1|Block), 
               data = alldrag,
              family = poisson(link = 'log'))

tick10 <- glmer(Total_ticks ~ Plot + (1|Block), 
               data = alldrag,
              family = poisson(link = 'log'))

tick11 <- glmer(Total_ticks ~ Month + (1|Block), 
               data = alldrag,
              family = poisson(link = 'log'))

tick12 <- glmer(Total_ticks ~ Site + Year + (1|Block), 
               data = alldrag,
              family = poisson(link = 'log'))

tick13 <- glmer(Total_ticks ~ Site + Year + Plot + (1|Block), 
               data = alldrag,
              family = poisson(link = 'log'))

tick14 <- glmer(Total_ticks ~ Site + Year + Plot + Month + (1|Block), 
               data = alldrag,
              family = poisson(link = 'log'))


# calculate AIC of each model

tick_glmm_results <- AIC(tick8, tick9, tick10,
                    tick11, tick12, tick13,
                   tick14)

# add other metrics to table
tick_glmm_models <- list(tick8, tick9, tick10,
                    tick11, tick12, tick13,
                   tick14) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
tick_glmm_results$BIC <- sapply(tick_glmm_models, BIC) # add column for BIC

tick_glmm_model_summary <- lapply(tick_glmm_models, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(tick_glmm_models)) {
  tick_glmm_results$rsq[i] <- tick_glmm_model_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  tick_glmm_results$adj_rsq[i] <- tick_glmm_model_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
tick_glmm_results$variables <- c('Year','Site', 'Plot', 'Month', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

# add another column with random effects
tick_glmm_results$randomeffect <- c('Block','Block','Block','Block','Block','Block','Block')

# make a nice table!
tick_glmm_models <-kable(tick_glmm_results, digits = 2, align = 'c') %>%
  kable_styling()

twenty <- tick_glmm_models

twentyone <- export_summs(tick8,tick9,tick10,tick11, tick12, tick13, tick14, scale = TRUE)

```

I need to check if I can run linear regression (lm) models since CTL would apply to this dataframe.

Models
  tick15
    Total_ticks ~ Plot
    Plot is a significant predictor of total ticks 
        - p = 8.89e-06
        - adjusted r^2 = 0.0346 ; only 3.59% variation in the total number of ticks can be explained by plot type 
        
  tick16
    Total_ticks ~ Site
    Site is a significant predictor of total ticks 
        - p = 1.08e-06
        - adjusted r^2 = 0.05237 ; only 5.23% variation in the total number of ticks can be explained by plot type 
        
Graph
  twentytwo = table with p values

```{r linear regression of ticks}
## don't have two numeric variables to compare to so can't do correlation on this dataset, maybe later when I have temp data

# check for linearity, I know I shouldn't have categorical variables in there
plot.drag <-data.frame(alldrag[,2:3],alldrag[,5:6])
pairs.panels(plot.drag, density = TRUE, cor = FALSE, lm = TRUE)

#################### run linear regression models ##########################

####### Total_ticks ~ PLOT #######
tick15 <- lm(Total_ticks ~ Plot, data = alldrag)
summary(tick15)
# intercept (b0) : 1.1247  ; pvalue = 8.89e-06 [Plot Open]
# plot partial (b1) : 1.7097 ; pvalue = 1.82e-06
# plot total (b2) : 2.5183 ; pvalue = 2.62e-12
### ^^ for every one unit increase in plot Total, there is a corresponding 2.5183 increase in number of ticks
### my linear model is Yi = 1.1247 + 2.5183Xi

# r^2 = Multiple R-squared = 0.0359	; Adjusted R-squared = 0.0346
## ^^ 3.59% of the variation in the total number of ticks (Y) can be explained by the plot type (X)


####### Total_ticks ~ SITE #######
tick16 <- lm(Total_ticks ~ Site, data = alldrag)
summary(tick16)
# intercept (b0) : 1.2444   ; pvalue = 1.08e-06 [Site Arid]
# site intermediate (b1) : 3.0155 ; pvalue = < 2e-16
# site mesic (b2) : 0.7705 ; pvalue = 0.0305
### ^^ for every one unit increase in site Arid, there is a corresponding 2.5183 increase in number of ticks
### my linear model is Yi = 1.2444 + 3.0155Xi

# r^2 = Multiple R-squared =  0.05373	; Adjusted R-squared = 0.05237 
## ^^ 5.37% of the variation in the total number of ticks (Y) can be explained by the site type (X)

# put these models in nice graph
summ(tick15, confint = TRUE)
summ(tick16, confint = TRUE)

# export both graphs
twentytwo <- export_summs(tick15, tick16, scale = TRUE)


```



###Mammal Data


Excel sheets called 
- 'tejon_mammals1819_09022020'
- 'tejon_mammalcount_09032020'


in these datasheets I name columns with lowercase compared to tick data sheets (i.e. month not Month)
```{r import data frames and organize}

# full dataset
mammals <- read.csv("~/Desktop/tejon_mammals1819_09022020.csv")

# subset for important
mammal <-data.frame(mammals[,4:6],mammals[,9])

# numeric dataframe for community analysis
Count <- read.csv("~/Desktop/tejon_mammalcount_09032020.csv", header = TRUE)

# remove the arid with NAs, this will be the full dataset with species richenss and diversity added
count <- Count[-4,]

# keep only numeric data to run community analyses
numeric <- count[,c(-1,-2,-9,-10)]

# organize data into right forms
count$plot <- factor(count$plot, 
                        levels = c('open','partial','total'))


# species richness
sppr <- specnumber(numeric)

# shannon diversity
shannondiv <- diversity(numeric)

# add species richness to count
count$sppr<-specnumber(numeric)

# add shannon diversity to count
count$shannondiv <- diversity(numeric)

plotcolor <- pal




```

Graphs


Total animal

twentythree = total animal abundance by site (Tukey Kramer values)
twentyfour = total animal abundance by plot
twentyfive = total animal abundance by site with plot fill
twentysix = total animal abundance by site and plot combo (I like this one)
```{r}
########### TOTAL ANIMAL (Y) ############

# total animal abundance by site
twentythree <-ggplot(data = count,
       aes(x = site, y = total,
           fill = site))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  clean_background +
  xlab('Site Types') + ylab('Animal Abundance')+
  ggtitle('Animal Abundance by Site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = 42,
           size = 9, color = 'red') +
  annotate('text', label = 'a', 
           x = 2, y = 23,
           size = 9, color = 'red') +
    annotate('text', label = 'b', 
           x = 3, y = 72,
           size = 9, color = 'red')

# total animal abundance by plot
twentyfour <-ggplot(data = count,
       aes(x = plot, y = total,
       fill = plot))+
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Plot Types') + ylab('Animal Abundance')+
  ggtitle('Animal Abundance by Plot')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5))  



##  total animal abundance by site with fill
twentyfive <-ggplot(data = count,
       aes(x = site, y = total,
           fill = plot))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Site Types') + ylab('Animal Abundance')+
  ggtitle('Animal Abundance by Site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5)) 



twentysix <- ggarrange(twentythree + rremove('legend'), twentyfour + rremove('ylab') +rremove('legend'),ncol = 2)

twentythree
twentyfour
twentyfive
twentysix
```

Graphs

twentyseven = species richness by site type (boxplot)
twentyeight = species richness by plot type (boxplot)
twentynine = species richness by site type with error bars
thirty = species richness by plot type with error bars

```{r species richness by site and plot}

############################## SITE ##############################
## species richness by site
twentyseven <- ggplot(count, aes(x = site, y = sppr))+
  geom_boxplot(fill = sitecolor) +
  coord_cartesian(ylim = c(0,6)) +
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  clean_background + 
  labs(x = "Site Types",
       y = "Species Richness",
       title = "Species Richness by Site") +
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5))


############################## PLOT ##############################

## species richness by plot

twentyeight <- ggplot(count, aes(x = plot, y = sppr))+
  geom_boxplot(fill = plotcolor) +
  coord_cartesian(ylim = c(0,6)) +
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  clean_background + 
  labs(x = "Site Types",
       y = "Species Richness",
       title = "Species Richness by Plot") +
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5))

### geom_bar with error bars

# species diversity by site with error bars

twentynine <- ggplot(data = count,
       aes(x = site, y = sppr,
           fill = site))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  clean_background +
  xlab('Site Types') + ylab('Spieces Richness')+
  ggtitle('Species Richness by Site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5)) 



# species diversity by plot with error bars

thirty <- ggplot(data = count,
       aes(x = plot, y = sppr,
           fill = plot))+
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Plot Types') + ylab('Spieces Richness')+
  ggtitle('Species Richness by Plot')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5)) 

twentyseven
twentyeight
twentynine
thirty
```

Shannon Diversity

Plots

thirtyone = shannon diversity by site (boxplot)
thirtytwo = shannon diversity by plot (boxplot)
thirtythree = shannon diversity by site (Tukey Kramer values)
thirtyfour = shannon diversity by plot
```{r}

## shannon diversity by site
thirtyone <- ggplot(count, aes(x = site, y = shannondiv))+
  geom_boxplot(fill = sitecolor) +
  coord_cartesian(ylim = c(0,1.5)) +
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  clean_background + 
  labs(x = "Site Types",
       y = "Shannon Diversity",
       title = "Shannon Diversity by Site") +
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5))

## shannon diversity by plot

thirtytwo <- ggplot(count, aes(x = plot, y = shannondiv))+
  geom_boxplot(fill = plotcolor) +
  coord_cartesian(ylim = c(0,1.5)) +
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  clean_background + 
  labs(x = "Site Types",
       y = "Shannon Diversity",
       title = "Shannon Diversity by Plot") +
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5))

### geom_bar with error bars

# shannon diversity by site with error bars

thirtythree <- ggplot(data = count,
       aes(x = site, y = shannondiv,
           fill = site))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  clean_background +
  xlab('Site Types') + ylab('Shannon Diversity')+
  ggtitle('Shannon Diversity by Site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'ab', 
           x = 1, y = 1.1,
           size = 9, color = 'red') +
  annotate('text', label = 'a', 
           x = 2, y = .7,
           size = 9, color = 'red') +
    annotate('text', label = 'b', 
           x = 3, y = 1.3,
           size = 9, color = 'red') 



# shannon diversity by plot with error bars

thirtyfour <- ggplot(data = count,
       aes(x = plot, y = shannondiv,
           fill = plot))+
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Plot Types') + ylab('Shannon Diversity')+
  ggtitle('Shannon Diversity by Plot')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5)) 

thirtyone
thirtytwo
thirtythree
thirtyfour
```

ANOVA 

1. plot type (X)
    mammal 1 : abundance (Y) 
    mammal 2 : shannon diversity (Y) 
    mammal 3 : species richness (Y) 
2. site type 
    mammal 4 : abundance (Y) 
    mammal 5 : shannon diversity (Y) 
    mammal 6 : species richness (Y) 
```{r ANOVA}

# real quick

### plot on mammal metrics
mammal1 <- aov(total ~ plot, data = count)
summary(mammal1) # p value = 0.597

mammal2 <- aov(sppr ~ plot, data = count)
summary(mammal2) # p value = 0.422

mammal3 <-aov(shannondiv ~ plot, data = count)
summary(mammal3) # p value = 0.501

### site on mammal metrics
mammal4 <- aov(total ~ site, data = count)
summary(mammal4) # p value = 0.00857 [SIGNIFICANT]

mammal5 <- aov(sppr ~ site, data = count)
summary(mammal5) # p value = 0.0723

mammal6 <-aov(shannondiv ~ site, data = count)
summary(mammal6) # p value = 0.0485 [SIGNIFICANT]



## mammal4 and mammal6 are signficant so I will check residuals and run a Tukey Kramer


########## Mammal4 (total ~ site)
# run an ANOVA
plot(mammal4)

# check residuals
res4 = mammal4$residuals
shapiro.test(res4) # p = 0.617 (p > 0.05) so data is normal
hist(res4)
leveneTest(total ~ site, data = count) # p = 0.781, (p > 0.05) so variances are equal

summary(mammal4)
# Fvalue = 11.66
# p = 0.00857 (p < 0.05), reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(mammal4)

# let's do this in a visual way
Post_hoc4 <-glht(mammal4, linfct = mcp(site = 'Tukey'))
summary(Post_hoc4)

############### ^ mesic is significantly different (p < 0.001)


confint(Post_hoc4) # pairwise test
cld(Post_hoc4) # arid & intermediate = a ; mesic = b , so intermediate is different than arid & mesic
plot(Post_hoc4) # plot 95% CIs

############ ^^^^ the total mammal counts is significantly different in Mesic than Intermediate and Arid!
# Mesic has a different letter & CIs don't overlap with 0 & p-values are significant




########## Mammal6 (shannondiv ~ site)
# run an ANOVA
plot(mammal6)

# check residuals
res6 = mammal6$residuals
shapiro.test(res6) # p = 0.4144 (p > 0.05) so data is normal
hist(res6)
leveneTest(shannondiv ~ site, data = count) # p = 0.3411, (p > 0.05) so variances are equal

summary(mammal6)
# Fvalue = 5.226
# p = 0.0485 (p < 0.05), reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(mammal6)

# let's do this in a visual way
Post_hoc6 <-glht(mammal6, linfct = mcp(site = 'Tukey'))
summary(Post_hoc6)



confint(Post_hoc6) # pairwise test
cld(Post_hoc6) # arid = ab, & intermediate = a ; mesic = b , so intermediate and mesic are different 
plot(Post_hoc6) # plot 95% CIs

############ ^^^^ the shannon diversity is significantly different between intermediate and mesic but these results are not as clear 
# intermediate has a different letter & CIs don't overlap with 0 & p-values are significant



```

PCA plot
- honestly these are not as clear, but willing to keep working on them if people are interested

Graphs

PCA1 = count by site, shows some grouping by site
PCA2 = count by species
  site 1 - 3 : arid
  site 4 - 7 : intermediate
  site 8 - 10 : mesic
```{r PCA plots - needs more work}

################### Attempt one ###################

mam.pca <- prcomp(numeric, center = TRUE, scale = TRUE)
print(mam.pca)
plot(mam.pca, type = 'l')
summary(mam.pca)

out <- as.data.frame(mam.pca$x) #get the PC values for each observation so we can plot it

out$site <-c('arid','arid','arid',
                 'intermediate','intermediate','intermediate',
                 'mesic','mesic','mesic')
PCA1 <- ggplot(out, aes(x=PC1, y=PC2, color = site))+
  clean_background+
  geom_point()



################### Attempt two ###################
# redundancy analyssis
mammalPCA <- rda(numeric)
mammalPCA


PCAscores <- scores(mammalPCA, display = "sites") %>% 
  as.data.frame() %>% 
  rownames_to_column("site") %>% 
  full_join(site_type, by = "site")


PCAvect <- scores(mammalPCA, display = "species") %>% 
  as.data.frame()

PCA2 <- ggplot() +
  geom_point(data = PCAscores, aes(x = PC1, y = PC2, color = site)) +
  geom_vline(xintercept = c(0), color = "grey70", linetype = 2) +
  geom_hline(yintercept = c(0), color = "grey70", linetype = 2) +
  clean_background +
  geom_segment(data = PCAvect, aes(x = 0, y = 0, xend = PC1, yend = PC2), arrow = arrow(length = unit(0.2, "cm"))) +
  geom_text(data = PCAvect, aes(x = PC1, y = PC2, label = rownames(PCAvect))) +
  labs(x = "PC1",
       y = "PC2",
       title = "Principal Components Analysis") 

PCA1
PCA2
```

################ COMBO DATASETS ################


Excel sheet 'tejon_tickmammal_09032020'

Has tick and mammmal data combined with calculated species richness and shannondiversity metrics associated with each site
```{r read in datasets and organize}
combo <- read.csv("~/Desktop/tejon_tickmammal_09032020.csv")

combo$site <- factor(combo$site, 
                        levels = c('Arid','Intermediate','Mesic'))

combo$plot <- factor(combo$plot, 
                        levels = c('Open','Partial','Total'))
combo$month <- factor(combo$month, 
                        levels = c('January', 'February', 'March',
                                   'April', 'May', 'June', 'July',
                                   'August', 'September', 'October',
                                   'November', 'December'))
combo$year = as.factor(combo$year)


```

**Linear Regression models - may not be appropriate for these data**

models : tick14 - tick19
- Lowest AIC for *multivariables* is tick18 (total_tick ~ site, year, plot) 
- Lowest AIC for *singularvariable* is tick14 (total_tick ~ year)

models : mammal7 - mammal12
- Lowest AIC for *multivariables* is mammal11 (total_mammal ~ site, year, plot) 
- Lowest AIC for *singularvariable* is mammal (total_mammal ~ site)


models : combo1 - combo6
- Lowest AIC for *multivariables* is combo5 (total_tick ~ site, year, plot, shannon) 
- Lowest AIC for *singularvariable* is combo2 (total_tick ~ mammal species richness) [not very different between tot, richness, shannon AICs]


Graphs/ Tables with df, AIC, BIC, rsq, adj_rsq, variables
1. tickmodel_lm 
2. mammalmodel_lm 
3. combomodel_lm
```{r linear regression models}
####################### TICKS ###########################
##### run individual models on total mammal abundance
tick14 <- lm(total_ticks ~ year, 
               data = combo)

tick15 <- lm(total_mammal ~ site, 
               data = combo)

tick16 <- lm(total_mammal ~ plot, 
               data = combo)

tick17 <- lm(total_mammal ~ site + year, 
               data = combo)

tick18  <- lm(total_mammal ~ site + year + plot, 
               data = combo)

tick19 <- lm(total_mammal ~ site + year + plot + month, 
               data = combo)


# calculate AIC of each model

result_lm_tick <- AIC(tick14, tick15, tick16,
                        tick17, tick18, tick19)

# add other metrics to table
model_lm_tick <- list(tick14, tick15, tick16,
                        tick17, tick18, tick19) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_lm_tick$BIC <- sapply(model_lm_tick, BIC) # add column for BIC

model_lm_tick_summary <- lapply(model_lm_tick, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_lm_tick)) {
  result_lm_tick$rsq[i] <- model_lm_tick_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_lm_tick$adj_rsq[i] <- model_lm_tick_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_lm_tick$variables <- c('Year','Site', 'Plot', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

tickmodel_lm <-kable(result_lm_tick, digits = 2, align = 'c',
                        caption = '<b>Linear regression models for total tick abundance</b>', 
                        format = 'html') %>%
  kable_styling()

tickmodel_lm 




####################### MAMMALS ###########################
##### run individual models on total mammal abundance
mammal7 <- lm(total_mammal ~ year, 
               data = combo)

mammal8 <- lm(total_mammal ~ site, 
               data = combo)

mammal9 <- lm(total_mammal ~ plot, 
               data = combo)

mammal10 <- lm(total_mammal ~ site + year, 
               data = combo)

mammal11 <- lm(total_mammal ~ site + year + plot, 
               data = combo)

mammal12 <- lm(total_mammal ~ site + year + plot + month, 
               data = combo)


# calculate AIC of each model

result_lm_mammal <- AIC(mammal7, mammal8,mammal9,
               mammal10, mammal11, mammal12)

# add other metrics to table
model_lm_mammal <- list(mammal7, mammal8,mammal9,
               mammal10, mammal11, mammal12) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_lm_mammal$BIC <- sapply(model_lm_mammal, BIC) # add column for BIC

model_lm_mammal_summary <- lapply(model_lm_mammal, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_lm_mammal)) {
  result_lm_mammal$rsq[i] <- model_lm_mammal_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_lm_mammal$adj_rsq[i] <- model_lm_mammal_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_lm_mammal$variables <- c('Year','Site', 'Plot', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

mammalmodel_lm <-kable(result_lm_mammal, digits = 2, align = 'c',
                        caption = '<b>Linear regression models for total mammal abundance</b>', 
                        format = 'html') %>%
  kable_styling()

mammalmodel_lm 


####################### COMBINATION OF TICKS AND MAMMALS ###########################

combo1 <- lm(total_ticks ~ total_mammal, 
               data = combo)

combo2 <- lm(total_ticks ~ rich_mammal, 
               data = combo)

combo3 <- lm(total_ticks ~ shan_mammal, 
               data = combo)

combo4 <- lm(total_ticks ~ shan_mammal + total_mammal, 
               data = combo)

combo5 <- lm(total_ticks ~ site + year + plot + month + shan_mammal, 
               data = combo)

combo6 <- lm(total_ticks ~ site + year + plot + month + shan_mammal + total_mammal, 
               data = combo)


# calculate AIC of each model

result_lm_combo <- AIC(combo1,combo2, combo3,combo4, combo5,
                        combo6)

# add other metrics to table
model_lm_combo <- list(combo1,combo2, combo3,combo4, combo5,
                        combo6) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_lm_combo$BIC <- sapply(model_lm_combo, BIC) # add column for BIC

model_lm_combo_summary <- lapply(model_lm_combo, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_lm_combo)) {
  result_lm_combo$rsq[i] <- model_lm_combo_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_lm_combo$adj_rsq[i] <- model_lm_combo_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_lm_combo$variables <- c('Total Mammal','Mammal Species Richness', 'Mammal Shannon Diversity', 'Shannon + Total', 'Site + Year + Plot + Shannon', 'Site + Year + Plot + Shannon + Total')

combomodel_lm <-kable(result_lm_combo, digits = 2, align = 'c',
                        caption = '<b>Linear regression models for tick abundance with mammal variables</b>', 
                        format = 'html') %>%
  kable_styling()

combomodel_lm 

```

**Generalized Linear Regression models**

models : tick20 - tick25
- Lowest AIC for *multivariables* is tick24 (total_tick ~ site, year, plot) [same as lm]
- Lowest AIC for *singularvariable* is tick20 (total_tick ~ year) [very clear better singular predictor]

models : mammal13 - mammal18
- Lowest AIC for *multivariables* is mammal17 (total_mammal ~ site, year, plot) [same as lm]
- Lowest AIC for *singularvariable* is mammal14 (total_mammal ~ site) [very clear better singular predictor]


models : combo7 - combo12
- Lowest AIC for *multivariables* is combo12 (total_tick ~ site, year, plot, shannon, total) [different than lm] 
- Lowest AIC for *singularvariable* is combo28 (total_tick ~ mammal species richness) [different than lm]


Graphs/ Tables with df, AIC, BIC, rsq, adj_rsq, variables
1. tickmodel_glm 
2. mammalmodel_glm 
3. combomodel_glm

```{r}
####################### TICKS ###########################
##### run individual models on total mammal abundance

library(lme4)
tick20 <- glm(total_ticks ~ year, 
               data = combo,
              family = 'poisson')

tick21 <- glm(total_mammal ~ site, 
               data = combo,
              family = 'poisson')

tick22 <- glm(total_mammal ~ plot, 
               data = combo,
              family = 'poisson')

tick23 <- glm(total_mammal ~ site + year, 
               data = combo,
              family = 'poisson')

tick24  <- glm(total_mammal ~ site + year + plot, 
               data = combo,
              family = 'poisson')

tick25 <- glm(total_mammal ~ site + year + plot + month, 
               data = combo,
              family = 'poisson')


# calculate AIC of each model

result_glm_tick <- AIC(tick20, tick21, tick22,
                        tick23, tick24, tick25)

# add other metrics to table
model_glm_tick <- list(tick20, tick21, tick22,
                        tick23, tick24, tick25) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_glm_tick$BIC <- sapply(model_glm_tick, BIC) # add column for BIC

model_glm_tick_summary <- lapply(model_glm_tick, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_glm_tick)) {
  result_glm_tick$rsq[i] <- model_glm_tick_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_glm_tick$adj_rsq[i] <- model_glm_tick_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_glm_tick$variables <- c('Year','Site', 'Plot', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

tickmodel_glm <-kable(result_glm_tick, digits = 2, align = 'c',
                        caption = '<b>Generalized linear regression models for total tick abundance</b>', 
                        format = 'html') %>%
  kable_styling()

tickmodel_glm 




####################### MAMMALS ###########################
##### run individual models on total mammal abundance
mammal13 <- glm(total_mammal ~ year, 
               data = combo,
              family = 'poisson')

mammal14 <- glm(total_mammal ~ site, 
               data = combo,
              family = 'poisson')

mammal15 <- glm(total_mammal ~ plot, 
               data = combo,
              family = 'poisson')

mammal16 <- glm(total_mammal ~ site + year, 
               data = combo,
              family = 'poisson')

mammal17 <- glm(total_mammal ~ site + year + plot, 
               data = combo,
              family = 'poisson')

mammal18 <- glm(total_mammal ~ site + year + plot + month, 
               data = combo,
              family = 'poisson')


# calculate AIC of each model

result_glm_mammal <- AIC(mammal13, mammal14,mammal15,
               mammal16, mammal17, mammal18)

# add other metrics to table
model_glm_mammal <- list(mammal13, mammal14,mammal15,
               mammal16, mammal17, mammal18) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_glm_mammal$BIC <- sapply(model_glm_mammal, BIC) # add column for BIC

model_glm_mammal_summary <- lapply(model_glm_mammal, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_glm_mammal)) {
  result_glm_mammal$rsq[i] <- model_glm_mammal_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_glm_mammal$adj_rsq[i] <- model_glm_mammal_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_glm_mammal$variables <- c('Year','Site', 'Plot', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

mammalmodel_glm <-kable(result_glm_mammal, digits = 2, align = 'c',
                        caption = '<b>Generalized linear regression models for total mammal abundance</b>', 
                        format = 'html') %>%
  kable_styling()

mammalmodel_glm 


####################### COMBINATION OF TICKS AND MAMMALS ###########################

combo7 <- glm(total_ticks ~ total_mammal, 
               data = combo,
              family = 'poisson')

combo8 <- glm(total_ticks ~ rich_mammal, 
               data = combo,
              family = 'poisson')

combo9 <- glm(total_ticks ~ shan_mammal, 
               data = combo,
              family = 'poisson')

combo10 <- glm(total_ticks ~ shan_mammal + total_mammal, 
               data = combo,
              family = 'poisson')

combo11 <- glm(total_ticks ~ site + year + plot + month + shan_mammal, 
               data = combo,
              family = 'poisson')

combo12 <- glm(total_ticks ~ site + year + plot + month + shan_mammal + total_mammal, 
               data = combo,
              family = 'poisson')


# calculate AIC of each model

result_glm_combo <- AIC(combo7,combo8, combo9,combo10, combo11,
                        combo12)

# add other metrics to table
model_glm_combo <- list(combo7,combo8, combo9,combo10, combo11,
                        combo12) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_glm_combo$BIC <- sapply(model_glm_combo, BIC) # add column for BIC

model_glm_combo_summary <- lapply(model_glm_combo, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_glm_combo)) {
  result_glm_combo$rsq[i] <- model_glm_combo_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_glm_combo$adj_rsq[i] <- model_glm_combo_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_glm_combo$variables <- c('Total Mammal','Mammal Species Richness', 'Mammal Shannon Diversity', 'Shannon + Total', 'Site + Year + Plot + Shannon', 'Site + Year + Plot + Shannon + Total')

combomodel_glm <-kable(result_glm_combo, digits = 2, align = 'c',
                        caption = '<b>Generalized linear regression models for tick abundance with mammal variables</b>', 
                        format = 'html') %>%
  kable_styling()

combomodel_glm 



```

## Zero Inflated hurdle models

Negative binomial version is more significant than poisson

Models
*1. ZIP_round_down*
  Site was a significant predictor of total tick counts p = 1.73e-8
  Plot was a significant predictor of total tick counts = p < 2e-16
  Year was a significant predictor of total tick counts p < 2e-16

*2.H1downB (negative binomial)*
  Site Intermidate was a significant predictor of total tick counts p = 2e-16
  Site Mesic was a significant predictor of total tick counts p = 4.59e-5

  Plot Partial was a significant predictor of total tick counts p = 3.37e-13
  Plot Total was a significant predictor of total tick counts p < 2e-16

  Year was a significant predictor of total tick counts p < 2e-16

*3. ZIP_round_downmam*
  Site was a significant predictor of total mammal counts p = 1.73e-8
  Plot was a significant predictor of total mammal counts = p < 2e-16
  Year was a significant predictor of total mammal counts p < 2e-16

*4.H1downB (negative binomial)*
  Site Intermidate was a significant predictor of total mammal counts p = 2e-16
  Site Mesic was a significant predictor of total mammal counts p = 0.00824

  Plot Partial was a significant predictor of total mammal counts p = 0.02398
  

  Year was a significant predictor of total mammal counts p < 2e-16
```{r zero inflated models}
library(pscl)
library(lmtest)

######################## Tick abundances ##################

# zero inflated poisson
fldown <- formula(total_ticks ~ site + plot | year)
ZIP_round_down <- zeroinfl(fldown, dist = 'poisson',
                           link = 'logit',
                           data = combo)
summary(ZIP_round_down)

# zero adjusted poisson and negative binomial (hurdle models)
H1downA <- hurdle(fldown, dist = "poisson", link = "logit",data = combo)
H1downB <- hurdle(fldown, dist = "negbin", link = "logit",data = combo)
lrtest(H1downA,H1downB)
# Negative binomial version much more significant

summary(H1downB)



######################## Mammal abundances ########################

# zero inflated poisson
fldownmam <- formula(total_ticks ~ site + plot + total_mammal | year)
ZIP_round_downmam <- zeroinfl(fldown, dist = 'poisson',
                           link = 'logit',
                           data = combo)
summary(ZIP_round_downmam)

# zero adjusted poisson and negative binomial (hurdle models)
H1downAmam <- hurdle(fldownmam, dist = "poisson", link = "logit",data = combo)
H1downBmam <- hurdle(fldownmam, dist = "negbin", link = "logit",data = combo)
lrtest(H1downAmam,H1downBmam)
# Negative binomial version much more significant

summary(H1downBmam)
library(jtools)

```




```{r print out models}

# library(broom.mixed)
# library(ggstance)
# 
# 
# summ(tick24)
# summ(mammal17) 
# summ(mammal14)
# summ(combo12) 
# summ(combo28)
# 
# plot_summs(combo1, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .9)
# plot_summs(combo1, combo2, combo3)
# jtools::plot_summs(combo1)
# plot_summs(combo1)
# plot_summs(fit1, fit2, scale = TRUE, model.names = c('site', 'plot'))
# ## export this out to word
# install.packages('huxtable')
# library(huxtable)
# export_summs(fit1, fit2, scale = TRUE)
# 
# ## with confidence intervals instead of standard errors
# export_summs(fit1, fit2, scale = TRUE,
#             error_format = "[{conf.low}, {conf.high}]")
# 
# ##  save as word doc
# export_summs(fit1, fit2, scale = TRUE, 
#              to.file = "docx",
#              file.name = "test.docx")
```


---
title: "Tejon Analysis (09082020)"
author: "sbsambado"
date: "9/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(error = FALSE)
knitr::opts_chunk$set(strip.white = TRUE)


```

### *Background*

Data were collected by the Young lab at UCSB.

Data come from Tejon Ranch in southern California. 

Experimental design: 

3 Sites that vary in elevation

  + **Arid** (lowest), 
  +  **Intermediate** (middle) 
  + **Mesic** (highest)
  + Block design: 1, 2, 3
  
Within each site there are 3 Plot types that vary in animal exclusion

+ **Open** (no exclusion)
+ **Partial** (some exclusion)
+ **Total** (all exclusion, except small mammals?)

    
    

Data include:

Tick drags 
  
+ Time: Years (2016 - 2019) & most months
+ Species: *I. pacificus, D. occidentalis, D. variabiles*, Unknown
+ Total ticks per sampling
  
Mammal trapping:

+ Across: Years (2018, 2019) & months
+ Species: Peromyscus spp., and some non-peromysucs spp.
    

*Notes* : 

+ if < 2 animal for species, it was placed in the NA category (i.e. TEBO) 
+ removed Arid data where Plot = NA


#Outline of S. Sambado's analyses

**1. Tick data**

+ where it came from & how it's organized
+ exploratory data analysis (assortment of graphs)
+ basic statistics
+ ANOVAS
+ glms


**2. Mammal data**

+ where it came from & how it's organized
+ exploratory data analysis (assortment of graphs)
+ basic statistics
+ ANOVAS
+ glms


**3. Combination data (ticks & mammals)**

+ where it came from & how it's organized
+ glms 
+ hurdle models


```{r libraries and variables, include=FALSE}
library(tidyverse)
library(readr)
library(ggpubr)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(plyr)
library(car)
library(multcomp)
library(multcompView)
library(reshape2)
library(stringr)
library(car)
library(psych)
library(knitr)
library(nlme)
library(lme4)
library(kableExtra)
library(MASS)
library(grid)
library(vegan)
library(devtools)
library(ggfortify)
library(jtools)
library(effects)
devtools::install_github('gavinsimpson/ggvegan')


clean_background <- theme(plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("white"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12),
        legend.key = element_rect("white"))

plotcolor = c('darkseagreen1','darkseagreen3','darkseagreen4')
sitecolor = c('red4','red2','red')

```

**Second round of analyses 09292020**

Hillary's suggestions for models

My feeling is that we dont really have a question about months really right?  
so what about month to a random effect?  

also, if we are going to includ year, i think year should be a rainfall year, not a calendar year.  e.g. maybe nov -oct?  

again, though, to me there isnt really a question about year, maybe year just becomess a random effect?  We would need a lot more years to ask anything interesting about year.

does a poisson model fit better than a negative binomial?  zero inflated? i can play around with this later myself, but thought maybe you had already looked at this...

what about instead of including a categorical value for aridity you actually use a quantitative covariate for climate water deficit?  or temp?  or what would be best tick relevant climate covariate?

and plot ID should probably be a random effect too

so models become

Tick_abundance ~ climate + treatment + climate*treatment + 1|plotID + 1|month+ 1|rainfall year

others thoughts on this?

if there are multiple models with robust AIC support maybe we could also go with a model averaging approach?


```{r}

glm(Total_ticks ~ climate + treatment + climate*treatment + 1|month + 1|rainfall year)


glm(Total_ticks ~ diff  + Site + diff*Site + 1|Month + 1|rain_year, data = climate)

```


Treated rain year as beginning in November.

2016/2017 for November 2016 - October 2017
2017/2018 for November 2017 to October 2018
2018/2019 for November 2018 to October 2019
2019/2020 for November 2019 to October 2020

Assigned 1 weather station to 1 site

+ Took temperature data from `Monthly_Temp'15_'20.xlsx` that Stephanie calculated mean max and min temperatures (F) from relevant weather stations

+ Added temperature data to `tejon_tick_climate_09292020` which is a combination of `Monthly_Temp'15_'20.xlsx` and `Tick_Drags.xlsx`

**Arid : Lebec collected by NOAA**

+ ID : GHCND:USC00044863
+ Lat, Long : 34.83328, -118.86497
+ **Elevation: 1089.7 m**


**Intermediate : Loraine 5 NNE**

+ ID: GHCND:USC00045100
+ Lat, Long : 35.3836, -118.4122
+ **Elevation : 1290.8 m**


**Mesic : Chuchupate collected by NOAA**

+ ID : GHCND:USR0000CCHU
+ Lat, Long : 34.8083, -119.0125
+ **Elevation: 1493.5 m**


Treated rain year as beginning in November.

2016/2017 for November 2016 - October 2017
2017/2018 for November 2017 to October 2018
2018/2019 for November 2018 to October 2019
2019/2020 for November 2019 to October 2020


*imported data from sheet called `tejon_tick_climate_09292020`*
```{r}
climate <- read.csv("~/Desktop/tejon_tick_climate_09292020.csv")

str(climate)

# mean min
# no group pairing
ggplot(data = climate, aes(x = mean_min_F, y = Total_ticks))+
  geom_smooth()+
  clean_background
# group pairing
ggplot(data = climate, aes(x = mean_min_F, y = Total_ticks, group = Site, color = Site))+
  geom_smooth()+
  clean_background

## geom point

# group pairing
ggplot(data = climate, aes(x = mean_min_F, y = Total_ticks, group = Site, color = Site, size = diff))+
  geom_point(aes(size = diff))+
  clean_background

# diff

climate$diff <- climate$mean_max_F - climate$mean_min_F
View(climate)

# no group pairing
ggplot(data = climate, aes(x = diff, y = Total_ticks))+
  geom_smooth()+
  clean_background
# group pairing
ggplot(data = climate, aes(x = diff, y = Total_ticks, group = Site, color = Site))+
  geom_smooth()+
  clean_background


ggplot(data = climate, aes(y = diff, x = Site), color = rain_year)+
  geom_boxplot()+
  geom_point(aes(fill = rain_year))+
  clean_background


ggplot(data = climate, aes(y = mean_max_F, x = Site), color = rain_year)+
  geom_boxplot()+
  geom_point(aes(color = rain_year))+
  clean_background


glm(Total_ticks ~ diff, data = climate)
glm(Total_ticks ~ mean_max_F, data = climate)
glm(Total_ticks ~ mean_min_F, data = climate)

```

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**First round of analyses 09082020**

# Data - Tick Analysis


*imported data from sheet called 'tejon_all_tick_drags_09022020'*

```{r data importing and organizing, include=FALSE}

## full dataset
alldrag <- read.csv("~/Desktop/tejon_all_tick_drags_09022020.csv")

## break up by site
intermediate <- filter(alldrag, Site == 'Intermediate')
mesic <- filter(alldrag, Site == 'Mesic')
arid <- filter(alldrag, Site == 'Arid')


## aggregate tick count data
aggregateticks <- alldrag %>%
  group_by(Site) %>%
  group_by(Month) 

aggregate <-aggregate(aggregateticks$Total_ticks, 
                by = list(Month = aggregateticks$Month, 
                          Site = aggregateticks$Site, 
                          Plot = aggregateticks$Plot), FUN = sum)
colnames(aggregate) <- c('Month', 'Site','Plot','Total_ticks')
#print(aggregate)


## aggregate tick count data by year
aggregateyear <-aggregate(aggregateticks$Total_ticks, 
                by = list(Month = aggregateticks$Month, 
                          Site = aggregateticks$Site, 
                          Plot = aggregateticks$Plot,
                          Year = aggregateticks$Year), FUN = sum)
colnames(aggregateyear) <- c('Month', 'Site','Plot','Year', 'Total_ticks')


aggregate$Month <- factor(aggregate$Month, 
                        levels = c('January', 'February', 'March',
                                   'April', 'May', 'June', 'July',
                                   'August', 'September', 'October',
                                   'November', 'December'))

# transform variables into specific types of data
alldrag$Month <- factor(alldrag$Month, 
                        levels = c('January', 'February', 'March',
                                   'April', 'May', 'June', 'July',
                                   'August', 'September', 'October',
                                   'November', 'December'))

alldrag$Site <- factor(alldrag$Site,
                       levels = c('Arid', 'Intermediate', 'Mesic'))

alldrag$Plot <- factor(alldrag$Plot,
                       levels = c('Open', 'Partial', 'Total'))

alldrag$Year <- factor(alldrag$Year,
                       levels = c('2016', '2017', '2018', '2019'))


## Combination dataset
combo <- read.csv("~/Desktop/tejon_tickmammal_09032020.csv")

combo$site <- factor(combo$site, 
                        levels = c('Arid','Intermediate','Mesic'))

combo$plot <- factor(combo$plot, 
                        levels = c('Open','Partial','Total'))
combo$month <- factor(combo$month, 
                        levels = c('January', 'February', 'March',
                                   'April', 'May', 'June', 'July',
                                   'August', 'September', 'October',
                                   'November', 'December'))
combo$year = as.factor(combo$year)





```


> #Exploratory Data Analysis


# How does tick abudance (Y) vary across site type (X)?


```{r EDA total tick ~ site }

## represents average total ticks collected across the years and sitess

# ## no outliers
# one <- ggplot(data = aggregate, aes(x = Site, y = Total_ticks))+
#   geom_boxplot(fill = sitecolor, outlier.color = 'black', outlier.shape = NA)+
#   clean_background+
#   coord_cartesian(ylim = c(0, 200))+
#   xlab('Site Types') + ylab('Total Ticks')+
#   ggtitle('Total Ticks by Site \n no outliers')+
#   theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
#   theme(axis.text.x = element_text(face = 'bold'))

## with outliers
two <- ggplot(data = aggregate, aes(x = Site, y = Total_ticks))+
  geom_boxplot(fill = sitecolor, outlier.color = 'black', outlier.shape = 1)+
  clean_background +
  xlab('Site Types') + ylab('Total Ticks')+
  ggtitle('Total ticks by site')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold')) 


#one
two
```

# How does tick abundance (Y) vary by plot types (X)?


```{r EDA tick abundace ~ plot}

## represents average total ticks collected across the years and plots

## no outliers
# three <- ggplot(data = aggregate, aes(x = Plot, y = Total_ticks))+
#   geom_boxplot(fill = plotcolor, outlier.color = 'black', outlier.shape = NA)+
#   clean_background+
#   coord_cartesian(ylim = c(0,130))+
#   xlab('Plot Types') + ylab('Total Ticks')+
#   ggtitle('Total Ticks by Plot \n no outliers')+
#   theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
#   theme(axis.text.x = element_text(face = 'bold'))

## with outliers
four <- ggplot(data = aggregate, aes(x = Plot, y = Total_ticks))+
  geom_boxplot(fill = plotcolor, outlier.color = 'black', outlier.shape = 1)+
  clean_background+
  xlab('Plot Types') + ylab('Total Ticks')+
  ggtitle('Total ticks by plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold')) 


#three
four

```

# How does tick abundance (Y) vary by site (X) across plot types (X)?


```{r EDA tick abundance ~ site, fill = plot}

twelve <-ggplot(data = aggregate,
       aes(x = Site, y = Total_ticks,
           fill = Plot))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  theme_classic()+
  xlab('Site') + ylab('Total ticks')+
  ggtitle('Total tick abundance by site and plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) 
ggsave("TickAbundanceBargraphPlot_v1.pdf", dpi = 320)
twelve

```


# How does tick abundance (Y) vary by month (X) at each site (X)?


```{r EDA tick abundance ~ month by site}

ggplot(data = aggregate, aes(x = Month, y = Total_ticks))+
  facet_wrap( ~ Site, nrow = 3, scales = 'free')+
  geom_boxplot()+
  clean_background +
  xlab('Month') + ylab('Total tick abundance')+
  ggtitle('Total ticks by site type across months')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.title.y = element_text(face = 'bold'))+
  theme(axis.title.x = element_text(face = 'bold'))+
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))

```


# How does tick abundance (Y) vary by month (X) at each plot type (X) ?


```{r EDA tick abundance ~ year across plot types}

ggplot(data = aggregate, aes(x = Month, y = Total_ticks))+
  facet_wrap( ~ Plot, nrow = 3, scales = 'free')+
  geom_boxplot()+
  clean_background +
  xlab('Month') + ylab('Total tick abundance')+
  ggtitle('Total ticks by plot type across months')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold', size = 8)) +
  theme(axis.title.y = element_text(face = 'bold'))+
 theme(axis.title.x = element_text(face = 'bold'))+
  theme(axis.text.x = element_text(angle = 45))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12))

```


# How does tick abundance (Y) vary by year (X) across site types (X)?

*I know these graphs look wonky on .html, trying to trouble shoot this*

```{r EDA total ticks ~ month for arid }

# I know there is a better way/shorter code of doing this but it is what it is

### summaries by month

Aridmonthdrag16 <- alldrag %>%
  filter(Site == 'Arid') %>%
  group_by(Month) %>%
  filter(Year == '2016')

A16 <-aggregate(Aridmonthdrag16$Total_ticks, by = list(Month = Aridmonthdrag16$Month), FUN = sum)
a16 <- ggplot(data = A16, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  #labs(y = 'total ticks', title = 'Arid') +
  ggtitle('Arid - 2016')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) #+
  #annotate(geom = 'text', label = 'Arid', col = 'red',
               #x = 5, y = 5.8, fontface = 'bold')

Aridmonthdrag17 <- alldrag %>%
  filter(Site == 'Arid') %>%
  group_by(Month) %>%
  filter(Year == '2017')

A17 <-aggregate(Aridmonthdrag17$Total_ticks, by = list(Month = Aridmonthdrag17$Month), FUN = sum)
a17 <-ggplot(data = A17, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2017')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

Aridmonthdrag18 <- alldrag %>%
  filter(Site == 'Arid') %>%
  group_by(Month) %>%
  filter(Year == '2018')

A18 <-aggregate(Aridmonthdrag18$Total_ticks, by = list(Month = Aridmonthdrag18$Month), FUN = sum)
a18 <- ggplot(data = A18, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2018')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

Aridmonthdrag19 <- alldrag %>%
  filter(Site == 'Arid') %>%
  group_by(Month) %>%
  filter(Year == '2019')

A19 <-aggregate(Aridmonthdrag19$Total_ticks, by = list(Month = Aridmonthdrag19$Month), FUN = sum)
a19 <-ggplot(data = A19,aes(x = factor(Month), y = x, group = 1))+ 
  geom_line(na.rm = TRUE)+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2019')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

Ariddrags <- ggarrange(a16 + rremove('xlab') + rremove('ylab'), 
          a17 + rremove('xlab') + rremove('ylab'), 
          a18 + rremove('xlab') + rremove('ylab'), 
          a19 + rremove('xlab') + rremove('ylab'),
          nrow = 4, ncol = 1, rel_heights = c(.5, .5, .5,1),
          align = 'v') 

Ariddrags
```


```{r EDA total ticks ~ month for intermediate}

Intermediatemonthdrag16 <- alldrag %>%
  filter(Site == 'Intermediate') %>%
  group_by(Month) %>%
  filter(Year == '2016')

i16 <-aggregate(Intermediatemonthdrag16$Total_ticks, by = list(Month = Intermediatemonthdrag16$Month), FUN = sum)
i16 <- ggplot(data = i16, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('Intermediate - 2016')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) #+ 
  #annotate(geom = 'text', label = 'Intermediate', col = 'red',
               #x = 5, y = 7.8, fontface = 'bold')

Intermediatemonthdrag17 <- alldrag %>%
  filter(Site == 'Intermediate') %>%
  group_by(Month) %>%
  filter(Year == '2017')

i17 <-aggregate(Intermediatemonthdrag17$Total_ticks, by = list(Month = Intermediatemonthdrag17$Month), FUN = sum)
i17 <-ggplot(data = A17, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2017')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

Intermediatemonthdrag18 <- alldrag %>%
  filter(Site == 'Intermediate') %>%
  group_by(Month) %>%
  filter(Year == '2018')

i18 <-aggregate(Intermediatemonthdrag18$Total_ticks, by = list(Month = Intermediatemonthdrag18$Month), FUN = sum)
i18 <- ggplot(data = i18, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2018')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
      plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

Intermediatemonthdrag19 <- alldrag %>%
  filter(Site == 'Intermediate') %>%
  group_by(Month) %>%
  filter(Year == '2019')

i19 <-aggregate(Intermediatemonthdrag19$Total_ticks, by = list(Month = Intermediatemonthdrag19$Month), FUN = sum)
i19 <-ggplot(data = i19,aes(x = factor(Month), y = x, group = 1))+ 
  geom_line(na.rm = TRUE)+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2019')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

intermediatedrags <- ggarrange(i16 + rremove('xlab') + rremove('ylab'), 
          i17 + rremove('xlab') + rremove('ylab'), 
          i18 + rremove('xlab') + rremove('ylab'), 
          i19 + rremove('xlab') + rremove('ylab'),
          nrow = 4, rel_heights = c(.5, .5, .5,1),
          align = 'v') 

intermediatedrags

```


```{r EDA total ticks ~ month for mesic}

Mesicmonthdrag16 <- alldrag %>%
  filter(Site == 'Mesic') %>%
  group_by(Month) %>%
  filter(Year == '2016')

m16 <-aggregate(Mesicmonthdrag16$Total_ticks, by = list(Month = Intermediatemonthdrag16$Month), FUN = sum)
m16 <- ggplot(data = m16, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('Mesic - 2016')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) # + 
  #annotate(geom = 'text', label = 'Mesic', col = 'red',
               #x = 6, y = 8, fontface = 'bold')

Mesicmonthdrag17 <- alldrag %>%
  filter(Site == 'Mesic') %>%
  group_by(Month) %>%
  filter(Year == '2017')

m17 <-aggregate(Mesicmonthdrag17$Total_ticks, by = list(Month = Mesicmonthdrag17$Month), FUN = sum)
m17 <-ggplot(data = m17, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2017')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

Mesicmonthdrag18 <- alldrag %>%
  filter(Site == 'Mesic') %>%
  group_by(Month) %>%
  filter(Year == '2018')

m18 <-aggregate(Mesicmonthdrag18$Total_ticks, by = list(Month = Mesicmonthdrag18$Month), FUN = sum)
m18 <- ggplot(data = m18, aes(x = factor(Month), y = x, group = 1))+ 
  geom_line()+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2018')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
       axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
    theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 

Mesicmonthdrag19 <- alldrag %>%
  filter(Site == 'Mesic') %>%
  group_by(Month) %>%
  filter(Year == '2019')

m19 <-aggregate(Mesicmonthdrag19$Total_ticks, by = list(Month = Mesicmonthdrag19$Month), FUN = sum)
m19 <-ggplot(data = m19,aes(x = factor(Month), y = x, group = 1))+ 
  geom_line(na.rm = TRUE)+
  geom_point()+
  clean_background +
  xlab('Month') + ylab('Total Tick Abundance')+
  ggtitle('2019')+
  theme(axis.text = element_text(size = 6, face = 'bold'),
        axis.title = element_text( size = 2),
        plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 45))+
  theme(plot.title = element_text(color = "red"))+
  scale_x_discrete(labels =c(1,2,3,4,5,6,7,8,9,
                           10,11,12)) 


mesicdrags <- ggarrange(m16 + rremove('xlab') + rremove('ylab'), 
          m17 + rremove('xlab') + rremove('ylab'), 
          m18 + rremove('xlab') + rremove('ylab'), 
          m19 + rremove('xlab') + rremove('ylab'),
          nrow = 4, rel_heights = c(.5, .5, .5,1),
          align = 'v')
  
mesicdrags  
```


```{r full plot }

#Ariddrags 
#intermediatedrags
#mesicdrags

```



# How does tick abundance (Y) vary by year (X) across plot types (X)?


```{r EDA tick abundance ~ year, fill by plot}

aggregateyear <-aggregate(aggregateticks$Total_ticks, 
                by = list(Month = aggregateticks$Month, 
                          Site = aggregateticks$Site, 
                          Plot = aggregateticks$Plot,
                          Year = aggregateticks$Year), FUN = sum)
colnames(aggregateyear) <- c('Month', 'Site','Plot','Year', 'Total_ticks')
#print(aggregateyear)

thirteen <- ggplot(data = aggregateyear,
                   aes(x = Year, y = Total_ticks,
                       fill = Plot))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Year') + ylab('Total tick abundance')+
  ggtitle('Total tick abundance \nby year and plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) 

thirteen

```


> #**Basic Statistics**

**1. Shapiro wilk test **

 + **data are not normal (p < 2.2e-16)**

  + Poisson distribution of total ticks
   
   
   
**2. Welch's Two sample t-test **

  + *a. total tick abundance between arid and mesic sites* 
  + H0 : mean of total ticks are not different between arid and mesic sites
  + **significant difference in tick abundance between arid and mesic site types (p = 0.0008068)**
  
  + *b. total tick abundance between open and total plots* 
    + H0 : mean of total ticks are not different between arid and mesic sites
   +  **significant difference in tick abundance between open and total plot types (p = 2.258e-12)**
    
  + *c. total tick abundance between before and after fence setup*
   + H0 : mean of total ticks are not different pre and post fence
     + prefence = year 2016
     + postfence = 2017, 2018, 2019
     + **significant difference in tick abundance pre and post fence (p < 2.2e-16)**
     
     
     
**3. Wilcoxon rank sum test** 

  + *a. total tick abundance between arid and mesic sites* 
  + H0 : mean of total ticks are not different between arid and mesic sites
  + **significant difference in tick abundance between arid and mesic site types (p = 0.001193)**
  
  + *b. total tick abundance between open and total plots* 
   +  H0 : mean of total ticks are not different between arid and mesic sites
   + **significant difference in tick abundance between open and total plot types (p = 1.948e-11)**
    
  + *c. total tick abundance before and after fence*
     + H0 : mean of total ticks are not different pre and post fence
     + prefence = year 2016
     + postfence = 2017, 2018, 2019
     + **significant difference in tick abundance pre and post fence (p < 2.2e-16)**
     
**4. Kruskal-Wallis tests**

+ *Another method to validate significance across variables*


  + **total_ticks ~ site (p = 1.165e-09)**
  + **total_ticks ~ plot (p = 2.601e-12)**
  + **total_ticks ~ year (p < 2.2e-16)**
  
```{r kruskal-wallis test}

kw1 <- kruskal.test(total_ticks ~ site, data = combo) # p = 1.165e-09
kw2 <- kruskal.test(total_ticks ~ plot, data = combo) # p = 2.601e-12
kw3 <-kruskal.test(total_ticks ~ year, data = combo) # p < 2.2e-16

```
    
```{r basic stats on tick abundance data across extreme ends of site and plot type}

## check if data are normal

# shapiro-wilk test

  # H0 : data are normal
  # p < 0.5 data are not normal
shapiro.test(alldrag$Total_ticks) # severly not normal, p < 2.2e-16
#qqPlot(alldrag$Total_ticks) # data is not normal, do not run a t-test, like maybe CTL but no

# lavene's test
  # H0 : variance between 2 groups are equal
  # if you reject lavene's test use Welch's t-test

## a. exteme plot types
# let's create two groups, arid or mesic

aridd <- subset(alldrag, Site == 'Arid')
mesicc <- subset(alldrag, Site == 'Mesic')

t.test(aridd$Total_ticks, mesicc$Total_ticks)

## ^ p = 0.0008068, p < 0.05, 95% does not contain 0, therefore we reject our H0 and say there is a significant difference between the groups


## b. exteme site types

# let's create two groups, open or total

openn <- subset(alldrag, Plot == 'Open')
totall <- subset(alldrag, Plot == 'Total')

t.test(openn$Total_ticks, totall$Total_ticks)

## ^ p = 2.258e-12, p < 0.05, 95% does not contain 0, therefore we reject our H0 and say there is a significant difference between the groups


## c. pre and post fence setup
## paired t-test for pre-post fence (Welch Two sample t-test)
prefence <- combo %>%
  filter(year == '2016')


postfence <- combo %>%
  filter(year != '2016')

# check distributions and variance
#hist(log(prefence$total_ticks + 1)) # log transform to try to make it more normal
#hist(log(postfence$total_ticks + 1)) # log transform to try to make it more normal

# levene's test to be used for unequal variances when samples are not strictly normal
# comparing means when variances are not equal = Welch's two sample t-test
t.test(log(prefence$total_ticks + 1), log(postfence$total_ticks + 1)) # p < 2.2e-16

# wilcoxon rank sum test with continuity correction
wilcox.test(prefence$total_ticks, postfence$total_ticks) # p < 2.2e-16

wilcox.test(aridd$Total_ticks, mesicc$Total_ticks) # p = 0.001193

wilcox.test(openn$Total_ticks, totall$Total_ticks) # p = 1.948e-11

```

> #**ANOVAS**

# Is site a significant predictor of total tick abundances?

+ **Yes, site is a significant predictor of total tick abundances**

ANOVA summary:

  + H0 : the means of total ticks across all site types are equal
  + Fvalue = 39.52
  + **p < 2e-16 , reject H0 and conclude that 1 site is significantly different**

Tukey-Kramer:

+ **Intermediate is significantly different than arid (p < 1e-04) and mesic (p < 1e-04)**


```{r ANOVA for site type}

# H0 : all group means are equal
# HA : at least 1 mean is not equal

#boxplot(Total_ticks ~ Site, 
        #data = alldrag)
## ^ lots of outliers
# par(mfrow = c(2,2))
# with(alldrag, hist(Total_ticks[Site == 'Arid']))
# with(alldrag, hist(Total_ticks[Site == 'Intermediate']))
# with(alldrag, hist(Total_ticks[Site == 'Mesic']))

# run an ANOVA
site1 <- aov(Total_ticks ~ Site, 
        data = alldrag)
par(mfrow = c(2,2))
#plot(site1)

# check residuals
res = site1$residuals
shapiro.test(res) # p << 0.05 so data not normal
#hist(res)
leveneTest(Total_ticks ~ Site, 
        data = alldrag) # p << 0.05 so variances are not equal

summary(site1)
# Fvalue = 39.52
# p < 2e-16 , reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(site1)

# let's do this in a visual way
Post_hoc <-glht(site1, linfct = mcp(Site = 'Tukey'))
summary(Post_hoc)

############### ^ intermediate is significantly different (p < 0.001)


confint(Post_hoc) # pairwise test
cld(Post_hoc) # arid & mesic = a ; intermediate = b , so intermediate is different than arid & mesic
#plot(Post_hoc) # plot 95% CIs

############ ^^^^ the mean of total tick counts is significantly different in Intermediate than Mesic and Arid!
# Intermediate has a different letter & CIs don't overlap with 0 & p-values are significant

# Site
fourteen <- ggplot(data = alldrag,
       aes(x = Site, y = Total_ticks,
           fill = Site))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  theme_classic()+
  xlab('Site') + ylab('Total Ticks')+
  ggtitle('Total ticks by site')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = 1.8,
           size = 9, color = 'red') +
  annotate('text', label = 'b', 
           x = 2, y = 5,
           size = 9, color = 'red') +
    annotate('text', label = 'a', 
           x = 3, y = 2.5,
           size = 9, color = 'red')
fourteen

```



# Is plot type a significant predictor of total tick abundances?

+ **Yes, plot is a significant predictor of total tick abundances**

ANOVA summary:


  + H0 : the means of total ticks across all site types are equal
  + Fvalue = 25.98
  + **p = 8.33e-12, reject H0 and conclude that 1 site is significantly different**

Tukey-Kramer:

+ **Open is significantly different than partial (p < 1e-04) and total (p < 1e-04)**

```{r ANOVA plot type }

# H0 : all group means are equal
# HA : at least 1 mean is not equal

#boxplot(Total_ticks ~ Plot, 
        #data = alldrag)
## ^ lots of outliers

# par(mfrow = c(2,2))
# with(alldrag, hist(Total_ticks[Plot == 'Open']))
# with(alldrag, hist(Total_ticks[Plot == 'Partial']))
# with(alldrag, hist(Total_ticks[Plot == 'Total']))


plot1 <- aov(Total_ticks ~ Plot, 
        data = alldrag)
par(mfrow = c(2,2))
#plot(plot1)

# check residuals
resp = plot1$residuals
shapiro.test(resp) # p << 0.05 so data not normal
#hist(resp)
#leveneTest(Total_ticks ~ Year, 
        #data = alldrag) # p << 0.05 so variances are not equal


summary(plot1)
# Fvalue = 25.98 
# p < 8.33e-12  , reject H0 and conclude that 1 plot is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(plot1)

# let's do this in a visual way
Post_hocp <-glht(plot1, linfct = mcp(Plot = 'Tukey'))
summary(Post_hocp)

confint(Post_hocp) # pairwise test
cld(Post_hocp) # different letters are different from each other open is different than partial & total!
#plot(Post_hocp) # plot 95% CIs

########################  ^^^^ Open is significantly different

# Open has a different letter & CIs don't overlap with 0 & p-values are significant

# Plot
fifteen <-ggplot(data = alldrag,
       aes(x = Plot, y = Total_ticks,
           fill = Plot))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  theme_classic()+
  xlab('Plot') + ylab('Total Ticks')+
  ggtitle('Total ticks by plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = 1.6,
           size = 9, color = 'red') +
  annotate('text', label = 'b', 
           x = 2, y = 3.4,
           size = 9, color = 'red') +
    annotate('text', label = 'b', 
           x = 3, y = 4.3,
           size = 9, color = 'red')
fifteen

```



# Is year a significant predictor of total tick abundances?
**Yes, year is a significant predictor of total tick abundances**

ANOVA summary:


 + H0 : the means of total ticks across all site types are equal
  + Fvalue = 21.63
  + **p = 1.08e-13, reject H0 and conclude that 1 site is significantly different**

Tukey-Kramer:

+ **2016 is significantly different than 2017 (p < 0.001), 2018 (p < 0.001), 2019 (p < 0.001)**
+ **2017 and 2018 are significantly different than 2016 (p < 0.001) and 2019 (p = 0.00921, p = 0.01091 )**

```{r ANOVA for year}

# H0 : all group means are equal
# HA : at least 1 mean is not equal

#boxplot(Total_ticks ~ Year, 
        #data = alldrag)
## ^ lots of outliers

# par(mfrow = c(2,2))
# with(alldrag, hist(Total_ticks[Year == '2016']))
# with(alldrag, hist(Total_ticks[Year == '2017']))
# with(alldrag, hist(Total_ticks[Year == '2018']))
# with(alldrag, hist(Total_ticks[Year == '2019']))

year1 <- aov(Total_ticks ~ Year, 
        data = alldrag)
par(mfrow = c(2,2))
#plot(year1)

# check residuals
resy = year1$residuals
shapiro.test(resy) # p << 0.05 so data not normal
#hist(resy)
#leveneTest(Total_ticks ~ Year, 
        #data = alldrag) # p << 0.05 so variances are not equal

summary(year1)
# Fvalue = 21.63
# p  = 1.08e-13, p < 0.001 reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)

# need to transform year into factor to run TukeyHSD
class(alldrag$Year) # integer
alldrag$Year = as.factor(alldrag$Year)
class(alldrag$Year) #factor

TukeyHSD(year1)

# let's do this in a visual way
Post_hocy <-glht(year1, linfct = mcp(Year = 'Tukey'))
summary(Post_hocy)

confint(Post_hocy) # pairwise test
cld(Post_hocy) # different letters are different from each other
#plot(Post_hocy) # plot 95% CIs

#### ^^^^ 2017 & 2018 similar 'c', 2016 different 'a', 2019 different 'b'

# 2016, 2019, 2017 & 2018 has a different letter & CIs don't overlap with 0 & p-values are significant


# Plot
sixteen<- ggplot(data = alldrag,
       aes(x = Year, y = Total_ticks,
           fill = Year))+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  theme_classic()+
  xlab('Year') + ylab('Total Ticks')+
  ggtitle('Total ticks by year')+
  scale_fill_manual(values = c('lightblue1','lightblue2','lightblue3','lightblue4'))+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5),
        legend.position = "none") +
  annotate('text', label = 'a', 
           x = 1, y = .5,
           size = 9, color = 'red') +
  annotate('text', label = 'c', 
           x = 2, y = 3.93,
           size = 9, color = 'red') +
    annotate('text', label = 'c', 
           x = 3, y = 3.9,
           size = 9, color = 'red')+
   annotate('text', label = 'b', 
           x = 4, y = 2.72,
           size = 9, color = 'red')

sixteen

```


# Is month a significant predictor of total tick abundances?
**Yes, month is a significant predictor of total tick abundances**

ANOVA summary:


  + H0 : the means of total ticks across all site types are equal
  + Fvalue = 24.85
  + **p <2e-16, reject H0 and conclude that 1 site is significantly different**

Tukey-Kramer:

+ *This analysis is a little more messy, but there are months that are significantly different from each other*
+ **Specifically, April is different from every month except May**


```{r ANOVA for month}

# H0 : all group means are equal
# HA : at least 1 mean is not equal

#boxplot(Total_ticks ~ Month, 
        #data = alldrag)
## ^ lots of outliers


month1 <- aov(Total_ticks ~ Month, 
        data = alldrag)
par(mfrow = c(2,2))
#plot(month1)

# check residuals
resm = month1$residuals
shapiro.test(resm) # p << 0.05 so data not normal
#hist(resm)
leveneTest(Total_ticks ~ Month, 
        data = alldrag) # p << 0.05 so variances are not equal

summary(month1)
# Fvalue = 24.85
# p < 2e-16 , reject H0 and conclude that 1 month is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
#TukeyHSD(month1)

#par(mfrow = c(1,1))
# let's do this in a visual way
Post_hocm <-glht(month1, linfct = mcp(Month = 'Tukey'))
#summary(Post_hocm)

#confint(Post_hocm) # pairwise test
cld(Post_hocm) # different letters are different from each other
#plot(Post_hocm) # plot 95% CIs

#### ^^^^ Months (May?) is significantly different, this is kinda  poor way of analyzing months, maybe group by season but that doesn't say much either

seventeen <- ggplot(data = aggregate,
       aes(x = Month, y = Total_ticks))+
  geom_bar(stat = 'summary', fun.y = 'mean', fill = 'grey')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  theme_classic()+
  xlab('Month') + ylab('Total Ticks')+
  ggtitle('Total ticks by month')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5)) +
  annotate('text', label = 'a', 
           x = 1, y = 50,
           size = 7, color = 'red') +
  annotate('text', label = 'ab', 
           x = 2, y = 50,
           size = 7, color = 'red') +
    annotate('text', label = 'ac', 
           x = 3, y = 50,
           size = 7, color = 'red')+
   annotate('text', label = 'e', 
           x = 4, y = 50,
           size = 7, color = 'red') +
  annotate('text', label = 'de', 
           x = 5, y = 50,
           size = 7, color = 'red') +
  annotate('text', label = 'cd', 
           x = 6, y = 50,
           size = 7, color = 'red') +
    annotate('text', label = 'ab', 
           x = 7, y = 50,
           size = 7, color = 'red')+
   annotate('text', label = 'a', 
           x = 8, y = 50,
           size = 7, color = 'red')+
   annotate('text', label = 'a', 
           x = 9, y = 50,
           size = 7, color = 'red')+ 
  annotate('text', label = 'bc', 
           x = 10, y = 50,
           size = 7, color = 'red')+
  annotate('text', label = 'ac', 
           x = 11, y = 50,
           size = 7, color = 'red')+
  annotate('text', label = 'a', 
           x = 12, y = 50,
           size = 7, color = 'red')

seventeen
```





```{r plot of ANOVAS}
# plot(predictorEffects(plot1, ~ Plot),
#      lines=list(multiline=TRUE),
#      lattice=list(key.args=list(columns=2)),
#      confint=list(style="bars"))
# 
# plot(predictorEffects(site1, ~ Site),
#      lines=list(multiline=TRUE),
#      lattice=list(key.args=list(columns=2)),
#      confint=list(style="bars"))
# 
# plot(predictorEffects(year1, ~ Year),
#      lines=list(multiline=TRUE),
#      lattice=list(key.args=list(columns=2)),
#      confint=list(style="bars"))
# 
# plot(predictorEffects(month1, ~ Month),
#      lines=list(multiline=TRUE),
#      lattice=list(key.args=list(columns=2)),
#      confint=list(style="bars"))

```


> #**Generalized Linear Models**

#What are good predictors (X) of total tick abundance (Y)?

**Ran *generalized linear models* because data breaks assumptions of normality. Used family poisson because of count data.**

*Object **'tickmodels'** is table of df, AIC, BIC, variables used in glm models*

+ *lowest AIC: all 4 variables (Site, Year, Plot, Month)*
+ *lowest AIC for a single predictor = Year*
  + **Year AIC = 10496**
  + **Site AIC = 10665**
  + **Plot AIC = 10871**

models : tick1 - tick7 


```{r GLM for tick data}

tick1 <- glm(Total_ticks ~ Year, 
               data = alldrag,
             family = 'poisson')

tick2 <- glm(Total_ticks ~ Site, 
               data = alldrag,
              family = 'poisson')

tick3 <- glm(Total_ticks ~ Plot, 
               data = alldrag,
              family = 'poisson')

tick4 <- glm(Total_ticks ~ Month, 
               data = alldrag,
              family = 'poisson')

tick5 <- glm(Total_ticks ~ Site + Year, 
               data = alldrag,
              family = 'poisson')

tick6 <- glm(Total_ticks ~ Site + Year + Plot, 
               data = alldrag,
              family = 'poisson')

tick7 <- glm(Total_ticks ~ Site + Year + Plot + Month, 
               data = alldrag,
              family = 'poisson')


# calculate AIC of each model

tickresults <- AIC(tick1, tick2, tick3,
                    tick4, tick5, tick6,
                   tick7)

# add other metrics to table
tickmodels <- list(tick1, tick2, tick3,
                    tick4, tick5, tick6,
                   tick7) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
tickresults$BIC <- sapply(tickmodels, BIC) # add column for BIC

tick_model_summary <- lapply(tickmodels, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(tickmodels)) {
  tickresults$rsq[i] <- tick_model_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  tickresults$adj_rsq[i] <- tick_model_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
tickresults$variables <- c('Year','Site', 'Plot', 'Month', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

# make a nice table!
tickmodels <-kable(tickresults, digits = 2, align = 'c') %>%
  kable_styling()

eighteen <-tickmodels

eighteen
#nineteen <- export_summs(tick1, tick2, tick3, scale = TRUE)
#nineteen
#min(tickresults$AIC)

```
  
  
  
# Data - Mammal Analysis


Excel sheets called 

+ 'tejon_mammals1819_09022020'
+ 'tejon_mammalcount_09032020'

*Notes*

+ in these datasheets I name columns with lowercase compared to tick data sheets (i.e. month not Month)

```{r import data frames and organize, include=FALSE}

# full dataset
mammals <- read.csv("~/Desktop/tejon_mammals1819_09022020.csv")

# subset for important
mammal <-data.frame(mammals[,4:6],mammals[,9])

# numeric dataframe for community analysis
Count <- read.csv("~/Desktop/tejon_mammalcount_09032020.csv", header = TRUE)

# remove the arid with NAs, this will be the full dataset with species richenss and diversity added
count <- Count[-4,]

# keep only numeric data to run community analyses
numeric <- count[,c(-1,-2,-9,-10)]

# organize data into right forms
count$plot <- factor(count$plot, 
                        levels = c('open','partial','total'))


# calculate mammal species richness
sppr <- specnumber(numeric)

# calculate mamal shannon diversity
shannondiv <- diversity(numeric)

# add species richness to count
count$sppr<-specnumber(numeric)

# add shannon diversity to count
count$shannondiv <- diversity(numeric)

pal <- c('darkseagreen1','darkseagreen3','darkseagreen4')
plotcolor <- pal

```


> #**Exploratory Data Analysis**

# How does mammal abudance (Y) vary across site type (X)?


```{r animal abundance ~ site type}


twentythree <-ggplot(data = count,
       aes(x = site, y = total,
           fill = site))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  clean_background +
  xlab('Site Types') + ylab('Animal Abundance')+
  ggtitle('Total Animal abundance by site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5),
        legend.position = "none") +
  annotate('text', label = 'a', 
           x = 1, y = 42,
           size = 9, color = 'red') +
  annotate('text', label = 'a', 
           x = 2, y = 23,
           size = 9, color = 'red') +
    annotate('text', label = 'b', 
           x = 3, y = 72,
           size = 9, color = 'red')
twentythree

##  total animal abundance by site with fill
twentyfive <-ggplot(data = count,
       aes(x = site, y = total,
           fill = plot))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Site Types') + ylab('Animal Abundance')+
  ggtitle('Total animal abundance by site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5)) 

twentyfive
```


# How does mammal abudance (Y) vary across plot type (X)?

```{r mammal abundance ~ plot type}


twentyfour <-ggplot(data = count,
       aes(x = plot, y = total,
       fill = plot))+
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Plot Types') + ylab('Animal Abundance')+
  ggtitle('Total animal abundance by plot')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5),
        legend.position = "none")  

twentyfour

```


# How does mammal species richness (Y) vary by site type (X)?


```{r mammal species richness ~ site type}


twentynine <- ggplot(data = count,
       aes(x = site, y = sppr,
           fill = site))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  clean_background +
  xlab('Site Types') + ylab('Spieces Richness')+
  ggtitle('Mammal Species richness by site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5),
        legend.position = "none") 

twentynine

```


# How does mammal species richness(Y) vary by plot type (X)?

```{r mammal species richness ~ plot type}

thirty <- ggplot(data = count,
       aes(x = plot, y = sppr,
           fill = plot))+
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Plot Types') + ylab('Spieces Richness')+
  ggtitle('Mammal species richness by plot')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5),
        legend.position = "none") 

thirty


```

# How does shannon diversity (Y) vary by site types (X)?


```{r shannon diversity ~ site}

## shannon diversity by site
thirtyone <- ggplot(count, aes(x = site, y = shannondiv))+
  geom_boxplot(fill = sitecolor) +
  coord_cartesian(ylim = c(0,1.5)) +
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  clean_background + 
  labs(x = "Site Types",
       y = "Shannon Diversity",
       title = "Mammal shannon diversity by site") +
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5))

# shannon diversity by site with error bars

thirtythree <- ggplot(data = count,
       aes(x = site, y = shannondiv,
           fill = site))+
  scale_x_discrete(labels = c("Arid", "Intermediate", "Mesic")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('red4','red2','red'))+
  clean_background +
  xlab('Site Types') + ylab('Shannon Diversity')+
  ggtitle('Mammal shannon diversity by site')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5),
        legend.position = "none") +
  annotate('text', label = 'ab', 
           x = 1, y = 1.1,
           size = 9, color = 'red') +
  annotate('text', label = 'a', 
           x = 2, y = .7,
           size = 9, color = 'red') +
    annotate('text', label = 'b', 
           x = 3, y = 1.3,
           size = 9, color = 'red') 

thirtyone
thirtythree


```


# How does shannon diversity (Y) vary by plot types (X)?

```{r mammal shannon diversity ~ plot types}


thirtytwo <- ggplot(count, aes(x = plot, y = shannondiv))+
  geom_boxplot(fill = plotcolor) +
  coord_cartesian(ylim = c(0,1.5)) +
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  clean_background + 
  labs(x = "Site Types",
       y = "Shannon Diversity",
       title = "Mammal shannon diversity by plot") +
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5))

# shannon diversity by plot with error bars

thirtyfour <- ggplot(data = count,
       aes(x = plot, y = shannondiv,
           fill = plot))+
  scale_x_discrete(labels = c("Open", "Partial", "Total")) +
  geom_bar(stat = 'summary', fun.y = 'mean')+
  stat_summary(geom = 'errorbar', fun.data = mean_se, width = .4)+
  scale_fill_manual(values = c('darkseagreen1','darkseagreen3','darkseagreen4'))+
  clean_background +
  xlab('Plot Types') + ylab('Shannon Diversity')+
  ggtitle('Mammal shannon diversity by plot')+
  theme(axis.text = element_text(size = 12, face = 'bold'),
        axis.title = element_text( size = 14),
        plot.title = element_text(face = 'bold', hjust = 0.5),
        legend.position = "none") 

thirtytwo
thirtyfour


```


> #**Basic Statistics**

**1. Shapiro wilk test**

+ **data are normal (p = 0.5137)**
   

```{r}

## check if data are normal

# shapiro-wilk test

  # H0 : data are normal
  # p < 0.5 data are not normal
shapiro.test(count$total) # data are normal, p = 0.5137
#qqPlot(count$total) # data is normal

# lavene's test
  # H0 : variance between 2 groups are equal
  # if you reject lavene's test use Welch's t-test

```     
     

> #**ANOVAS**

**Only significant variable on total mammal abundances was site, not plot**

total mammal abundance ~ plot type

```{r quick ANOVAS}

### plot on mammal metrics
mammal1 <- aov(total ~ plot, data = count)
anova(mammal1) # p value = 0.597

```


mammal species richness ~ plot type

```{r}
mammal2 <- aov(sppr ~ plot, data = count)
anova(mammal2) # p value = 0.422

```


mammal shannon diversity ~ plot type

```{r}
mammal3 <-aov(shannondiv ~ plot, data = count)
anova(mammal3) # p value = 0.501

```

total mammal abundance ~ site type

```{r}
### site on mammal metrics
mammal4 <- aov(total ~ site, data = count)
anova(mammal4) # p value = 0.00857 [SIGNIFICANT]

```


mammal species richness ~ site type

```{r}
mammal5 <- aov(sppr ~ site, data = count)
anova(mammal5) # p value = 0.0723

```


mammal shannon diversity ~ site type

```{r}
mammal6 <-aov(shannondiv ~ site, data = count)
anova(mammal6) # p value = 0.0485 [SIGNIFICANT]


```


# Is site a significant predictor of total mammal abundances?

**Yes, site is a significant predictor of total tick abundances**

ANOVA summary:

   + H0 : the means of total ticks across all site types are equal
  + Fvalue = 11.66
  + **p = 0.00857, reject H0 and conclude that 1 site is significantly different**

Tukey-Kramer:

+ **Mesic is significantly different than arid (p = 0.04407) and intermediate (p = 0.00737)**

```{r ANOVA on total mammal abundance}

# run an ANOVA
par(mfrow = c(2,2))
#plot(mammal4)

# check residuals
res4 = mammal4$residuals
shapiro.test(res4) # p = 0.617 (p > 0.05) so data is normal
#hist(res4)
leveneTest(total ~ site, data = count) # p = 0.781, (p > 0.05) so variances are equal

summary(mammal4)
# Fvalue = 11.66
# p = 0.00857 (p < 0.05), reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(mammal4)

# let's do this in a visual way
Post_hoc4 <-glht(mammal4, linfct = mcp(site = 'Tukey'))
summary(Post_hoc4)

############### ^ mesic is significantly different (p < 0.001)


confint(Post_hoc4) # pairwise test
cld(Post_hoc4) # arid & intermediate = a ; mesic = b , so intermediate is different than arid & mesic
#plot(Post_hoc4) # plot 95% CIs

############ ^^^^ the total mammal counts is significantly different in Mesic than Intermediate and Arid!
# Mesic has a different letter & CIs don't overlap with 0 & p-values are significant


```

# Is site a significant predictor of mammal shannon diversity?

**Yes, site is a significant predictor of mammal shannon diversity**

ANOVA summary:

  + H0 : the means of total ticks across all site types are equal
  + Fvalue = 5.226
  + **p = 0.0485, reject H0 and conclude that 1 site is significantly different**

Tukey-Kramer:

+ **Mesic is significantly different than intermediate (p = 0.0415)**

```{r ANOVA on mammal shannon diversity}

# run an ANOVA
par(mfrow = c(2,2))
#plot(mammal6)

# check residuals
res6 = mammal6$residuals
shapiro.test(res6) # p = 0.4144 (p > 0.05) so data is normal
#hist(res6)
leveneTest(shannondiv ~ site, data = count) # p = 0.3411, (p > 0.05) so variances are equal

summary(mammal6)
# Fvalue = 5.226
# p = 0.0485 (p < 0.05), reject H0 and conclude that 1 site is significantly different

## ANOVA told us 1 mean is significantly different from the other
# Run a Tukey Kramer to avoid Type 1 error (running a bunch of t-tests)

# Tukey-Kramer test assumes that I've already ran an ANOVA & rejected my H0 (all means are equal across groups)
TukeyHSD(mammal6)

# let's do this in a visual way
Post_hoc6 <-glht(mammal6, linfct = mcp(site = 'Tukey'))
summary(Post_hoc6)



confint(Post_hoc6) # pairwise test
cld(Post_hoc6) # arid = ab, & intermediate = a ; mesic = b , so intermediate and mesic are different 
#plot(Post_hoc6) # plot 95% CIs

############ ^^^^ the shannon diversity is significantly different between intermediate and mesic but these results are not as clear 
# intermediate has a different letter & CIs don't overlap with 0 & p-values are significant



```


PCA plot

+ honestly these are not as clear, but willing to keep working on them if people are interested


PCA1 = count by species

  + site 1 - 3 : arid
  + site 4 - 7 : intermediate
  + site 8 - 10 : mesic
  
  
```{r PCA}

mam.pca <- prcomp(numeric, center = TRUE, scale = TRUE)
#print(mam.pca)
#plot(mam.pca, type = 'l')
summary(mam.pca)

out <- as.data.frame(mam.pca$x) #get the PC values for each observation so we can plot it

out$site <-c('arid','arid','arid',
                 'intermediate','intermediate','intermediate',
                 'mesic','mesic','mesic')
PCA1 <- ggplot(out, aes(x=PC1, y=PC2, color = site))+
  clean_background+
  geom_point()

PCA1

```


## Data - Combination of ticks and mammals

Excel sheet 'tejon_tickmammal_09032020'

Has tick and mammmal data combined with calculated species richness and shannondiversity metrics associated with each site

```{r read in datasets and organize, include=FALSE}


combo <- read.csv("~/Desktop/tejon_tickmammal_09032020.csv")

combo$site <- factor(combo$site, 
                        levels = c('Arid','Intermediate','Mesic'))

combo$plot <- factor(combo$plot, 
                        levels = c('Open','Partial','Total'))
combo$month <- factor(combo$month, 
                        levels = c('January', 'February', 'March',
                                   'April', 'May', 'June', 'July',
                                   'August', 'September', 'October',
                                   'November', 'December'))
combo$year = as.factor(combo$year)


```



> #**Generalized Linear Regression models**

models : tick20 - tick25

+ **Lowest AIC for *multivariables* is tick24 (total_tick ~ site, year, plot)**
+ ** Lowest AIC for *singularvariable* is tick20 (total_tick ~ year) **

models : mammal13 - mammal18

+ **Lowest AIC for *multivariables* is mammal17 (total_mammal ~ site, year, plot)**
+ **Lowest AIC for *singularvariable* is mammal14 (total_mammal ~ site)**


models : combo7 - combo12

+ **Lowest AIC for *multivariables* is combo12 (total_tick ~ site, year, plot, shannon, total)**
+ **Lowest AIC for *singularvariable* is combo28 (total_tick ~ mammal species richness)**


Graphs/ Tables with df, AIC, BIC, rsq, adj_rsq, variables

+ 1. tickmodel_glm 
+ 2. mammalmodel_glm 
+ 3. combomodel_glm

```{r GLMS ticks}



#library(lme4)

tick20 <- glm(total_ticks ~ year, 
               data = combo,
              family = 'poisson')

tick21 <- glm(total_mammal ~ site, 
               data = combo,
              family = 'poisson')

tick22 <- glm(total_mammal ~ plot, 
               data = combo,
              family = 'poisson')

tick23 <- glm(total_mammal ~ site + year, 
               data = combo,
              family = 'poisson')

tick24  <- glm(total_mammal ~ site + year + plot, 
               data = combo,
              family = 'poisson')

tick25 <- glm(total_mammal ~ site + year + plot + month, 
               data = combo,
              family = 'poisson')


# calculate AIC of each model

result_glm_tick <- AIC(tick20, tick21, tick22,
                        tick23, tick24, tick25)

# add other metrics to table
model_glm_tick <- list(tick20, tick21, tick22,
                        tick23, tick24, tick25) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_glm_tick$BIC <- sapply(model_glm_tick, BIC) # add column for BIC

model_glm_tick_summary <- lapply(model_glm_tick, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_glm_tick)) {
  result_glm_tick$rsq[i] <- model_glm_tick_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_glm_tick$adj_rsq[i] <- model_glm_tick_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_glm_tick$variables <- c('Year','Site', 'Plot', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

tickmodel_glm <-kable(result_glm_tick, digits = 2, align = 'c',
                        caption = '<b>Generalized linear regression models for total tick abundance</b>', 
                        format = 'html') %>%
  kable_styling()

tickmodel_glm 



```



```{r GLM mammals}

##### run individual models on total mammal abundance
mammal13 <- glm(total_mammal ~ year, 
               data = combo,
              family = 'poisson')

mammal14 <- glm(total_mammal ~ site, 
               data = combo,
              family = 'poisson')

mammal15 <- glm(total_mammal ~ plot, 
               data = combo,
              family = 'poisson')

mammal16 <- glm(total_mammal ~ site + year, 
               data = combo,
              family = 'poisson')

mammal17 <- glm(total_mammal ~ site + year + plot, 
               data = combo,
              family = 'poisson')

mammal18 <- glm(total_mammal ~ site + year + plot + month, 
               data = combo,
              family = 'poisson')


# calculate AIC of each model

result_glm_mammal <- AIC(mammal13, mammal14,mammal15,
               mammal16, mammal17, mammal18)

# add other metrics to table
model_glm_mammal <- list(mammal13, mammal14,mammal15,
               mammal16, mammal17, mammal18) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_glm_mammal$BIC <- sapply(model_glm_mammal, BIC) # add column for BIC

model_glm_mammal_summary <- lapply(model_glm_mammal, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_glm_mammal)) {
  result_glm_mammal$rsq[i] <- model_glm_mammal_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_glm_mammal$adj_rsq[i] <- model_glm_mammal_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_glm_mammal$variables <- c('Year','Site', 'Plot', 'Site + Year', 'Site + Year + Plot', 'Site + Year + Plot + Month')

mammalmodel_glm <-kable(result_glm_mammal, digits = 2, align = 'c',
                        caption = '<b>Generalized linear regression models for total mammal abundance</b>', 
                        format = 'html') %>%
  kable_styling()

mammalmodel_glm 

```



```{r GLM combo}

combo7 <- glm(total_ticks ~ total_mammal, 
               data = combo,
              family = 'poisson')

combo8 <- glm(total_ticks ~ rich_mammal, 
               data = combo,
              family = 'poisson')

combo9 <- glm(total_ticks ~ shan_mammal, 
               data = combo,
              family = 'poisson')

combo10 <- glm(total_ticks ~ shan_mammal + total_mammal, 
               data = combo,
              family = 'poisson')

combo11 <- glm(total_ticks ~ site + year + plot + month + shan_mammal, 
               data = combo,
              family = 'poisson')

combo12 <- glm(total_ticks ~ site + year + plot + month + shan_mammal + total_mammal, 
               data = combo,
              family = 'poisson')


# calculate AIC of each model

result_glm_combo <- AIC(combo7,combo8, combo9,combo10, combo11,
                        combo12)

# add other metrics to table
model_glm_combo <- list(combo7,combo8, combo9,combo10, combo11,
                        combo12) # keep models in the same order as they were created

# BIC places higher penalty on extra parameter
result_glm_combo$BIC <- sapply(model_glm_combo, BIC) # add column for BIC

model_glm_combo_summary <- lapply(model_glm_combo, summary)


# make for loop to extract r^2 and r^adj from each model
for(i in 1:length(model_glm_combo)) {
  result_glm_combo$rsq[i] <- model_glm_combo_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result_glm_combo$adj_rsq[i] <- model_glm_combo_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

# add column with variables used in model
result_glm_combo$variables <- c('Total Mammal','Mammal Species Richness', 'Mammal Shannon Diversity', 'Shannon + Total', 'Site + Year + Plot + Shannon', 'Site + Year + Plot + Shannon + Total')

combomodel_glm <-kable(result_glm_combo, digits = 2, align = 'c',
                        caption = '<b>Generalized linear regression models for tick abundance with mammal variables</b>', 
                        format = 'html') %>%
  kable_styling()

combomodel_glm 



```


```{r full model print out}

#tickmodel_glm 
#mammalmodel_glm 
#combomodel_glm 
```


> #**Zero Inflated hurdle models**

+ Neither total tick or mammal counts are normally distributed (shapiro.test p << 0.05, meaning data not normal).

+ The models are based on Poisson and Negative binomial distribution are expecting count data (integer values only).

Hurdle model: treat as 2 part process

  +  1st part is 0
  + 2nd part is non-zero
  
Zero inflated Poisson (ZIP):


  + Two types of 0s : good and bad
    + variance = mean

Zero inflated negative binomial (ZINB):


  
+ Negative binomial version is more significant than poisson

Models

**1. ZIP_round_down (poisson - tick counts)**

  + Site was a significant predictor of total tick counts **p = 1.73e-8**
  + Plot was a significant predictor of total tick counts  **p < 2e-16**
  + Year was a significant predictor of total tick counts **p < 2e-16**

**2. H1downB (negative binomial - tick counts)**

  + Site Intermidate was a significant predictor of total tick counts **p = 2e-16**
  + Site Mesic was a significant predictor of total tick counts **p = 4.59e-5**

  + Plot Partial was a significant predictor of total tick counts **p = 3.37e-13**
  + Plot Total was a significant predictor of total tick counts **p < 2e-16**

  + Year was a significant predictor of total tick counts **p < 2e-16**

**3. ZIP_round_downmam (poisson - mammal counts)**

*need to double check if this is applicable to mammal counts, I think how I currently have the dataframet set up this may not be appropriate*

  + Site was a significant predictor of total mammal counts **p = 1.73e-8**
  + Plot was a significant predictor of total mammal counts **p < 2e-16**
  + Year was a significant predictor of total mammal counts **p < 2e-16**

**4. H1downB (negative binomial - mammal counts)**

  + Site Intermidate was a significant predictor of total mammal counts **p = 2e-16**
  + Site Mesic was a significant predictor of total mammal counts **p = 0.00824**

  + Plot Partial was a significant predictor of total mammal counts **p = 0.02398**
  
  + Year was a significant predictor of total mammal counts **p < 2e-16**
  
  
```{r zero inflated models}
library(pscl)
library(lmtest)

## check to make sure data really aren't normal 

# ticks forsure not normally distributed
length(combo$total_ticks[combo$total_ticks == 0]) # 879
shapiro.test(combo$total_ticks) # p < 2.2e-16


# mammals are more evelyn distributed, but this dataset may not be the appropriate way to run these analyses
length(combo$total_mammal[combo$total_mammal == 0]) # 6
shapiro.test(combo$total_mammal) # p < 2.2e-16

#hist(combo$total_mammal)
min(combo$total_mammal, na.rm = TRUE) # 8
max(combo$total_mammal, na.rm = TRUE) # 72
length(combo$total_mammal) #1456
length(combo$total_mammal[combo$total_mammal == 0])/length(combo$total_mammal) #0.004120879
#hist(combo$total_mammal, 50)
mean(combo$total_mammal, na.rm = TRUE) # 34.9131


######################## Tick abundances ##################

## part 1 of 0s
# zero inflated poisson (ZIP)
fldown <- formula(total_ticks ~ site + plot | site + plot) # what explains the load that's not 0 | explanatory variables if something is present or not
ZIP_round_down <- zeroinfl(fldown, dist = 'poisson',
                           link = 'logit',
                           data = combo)
summary(ZIP_round_down) # site and plot are signficant!

# zero inflated negative binomial (ZINB)
fldown <- formula(total_ticks ~ site + plot | site)
ZINB_round_down <- zeroinfl(fldown, dist = 'negbin', # changed distribution
                            link = 'logit',
                            data = combo)
summary(ZINB_round_down) # site and plot are significant!


# likeligood ratio test to compare ZIP and ZINB
# test the two models
lrtest(ZIP_round_down, ZINB_round_down) # ZINB p < 2.2e-16, so go with negative binomial


## part two non-0s
# Hurdle Models
# ZIP
H1downA <- hurdle(fldown, dist = "poisson", link = "logit",data = combo)
# ZINB
H1downB <- hurdle(fldown, dist = "negbin", link = "logit",data = combo)
lrtest(H1downA,H1downB) # Negative binomial version much more significant, p < 2.2e-16

summary(H1downB)



######################## Mammal abundances ########################

# zero inflated poisson
fldownmam <- formula(total_ticks ~ site + plot + total_mammal | year)
ZIP_round_downmam <- zeroinfl(fldown, dist = 'poisson',
                           link = 'logit',
                           data = combo)
summary(ZIP_round_downmam)

# zero adjusted poisson and negative binomial (hurdle models)
H1downAmam <- hurdle(fldownmam, dist = "poisson", link = "logit",data = combo)
H1downBmam <- hurdle(fldownmam, dist = "negbin", link = "logit",data = combo)
lrtest(H1downAmam,H1downBmam)
# Negative binomial version much more significant

summary(H1downBmam)


```
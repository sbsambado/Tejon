---
title: "Tejon_Analysis_10162020"
author: "sbsambado"
date: "10/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Import libraries and variables
```{r libraries and saved variables}
library(tidyverse)
library(readr)
library(ggpubr)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(plyr)
library(car)
library(multcomp)
library(multcompView)
library(reshape2)
library(stringr)
library(car)
library(psych)
library(knitr)
library(nlme)
library(lme4)
library(kableExtra)
library(MASS)
library(grid)
library(vegan)
library(devtools)
library(ggfortify)
library(jtools)
library(effects)
library(pscl)
library(lmtest)
devtools::install_github('gavinsimpson/ggvegan')


clean_background <- theme(plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("white"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12),
        legend.key = element_rect("white"))

plotcolor = c('darkseagreen1','darkseagreen3','darkseagreen4')
sitecolor = c('red4','red2','red')

rotatexaxistheme <- theme(axis.text.x = element_text(angle = 90, size = 8, vjust = 0.5))
ytitletheme <- theme(axis.title.y = element_text(face = 'bold', size = 12, vjust = 0.5))
xtitletheme <- theme(axis.title.x = element_text(face = 'bold', size = 12, vjust = 0.5))
```

Organize data
```{r organize data}

full <- read.csv("~/Desktop/tejon_tick_climate_10162020.csv")
#View(full)

full <- subset(full, select = -c(21:29))
full$Month <- factor(full$Month, 
                        levels = c('January', 'February', 'March',
                                   'April', 'May', 'June', 'July',
                                   'August', 'September', 'October',
                                   'November', 'December'))
full$Site <- factor(full$Site, 
                    levels = c('Arid', 'Intermediate', 'Mesic'))
names(full)
names(full)[1] <- "year"
names(full)[2] <- "month"
names(full)[3] <- "site"
names(full)[4] <- "block"
names(full)[5] <- "plot"
names(full)[6] <- "plotID"
names(full)[7] <- "totalticks"

names(full)[15] <- "maxF"
names(full)[16] <- "minF"
names(full)[19] <- "precip_in"
names(full)[20] <- "precip_mm"


full$year <- factor(full$year)
full$stationID_elevation <- factor(full$stationID_elevation)

str(full)

```

##EDA

**Total ticks ~ Plot ID**


+ O = Open , P = Partial , T = Total
+ 1 = Block 1 , 2 = Block 2 , 3 = Block 3

```{r aggregated data}
 col <- aggregate(totalticks ~ plotID  + site + year, data=full, FUN=sum)

ggplot(col, aes(x = plotID, y = totalticks, fill = site))+
  geom_boxplot()+
  geom_point()+
  theme_bw() +
  rotatexaxistheme+
  labs(x = 'Plot ID (2016 - 2019)', y = 'Total ticks', color = 'Site') +
  xtitletheme + ytitletheme
  # annotate(geom = "text", x = 3, y = 230, label = "O = Open", size = 4, color = 'red',hjust = "left justified")+
  # annotate(geom = "text", x = 3, y = 220, label = "P = Patial", size = 4, color = 'red',hjust = "left justified")+
  # annotate(geom = "text", x = 3, y = 210, label = "T = Total", size = 4, color = 'red',hjust = "left justified")
  

 col <- aggregate(totalticks ~ plotID  + site + year, data=full, FUN=sum)

ggplot(col, aes(x = plotID, y = totalticks, fill = site))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  facet_wrap(~ year, scale = 'free_y')+
  rotatexaxistheme+
  labs(x = 'Plot ID', y = 'Total ticks', fill = 'Site')+
  xtitletheme + ytitletheme


```

**Total ticks ~ Plot (fill site)**


```{r}
col <- aggregate(totalticks ~ plot  + site + year, data=full, FUN=sum)

ggplot(col, aes(x = plot, y = totalticks, fill = site))+
  geom_boxplot(aes(fill = site))+
  #geom_point()+
  theme_bw() +
  labs(x = 'Plot', y = 'Total ticks (2016 - 2019)', fill = 'Site')+
  xtitletheme + ytitletheme
  

  

 col <- aggregate(totalticks ~ plot  + site + year, data=full, FUN=sum)

ggplot(col, aes(x = plot, y = totalticks, fill = site))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  facet_wrap(~ year, scale = 'free_y')+
  scale_fill_manual(values =c('red4','red3','red'))+
  labs(x = 'Plot', y = 'Total ticks', fill = 'Site')+
  xtitletheme + ytitletheme

```


**Total ticks ~ Site (fill plot)**

```{r}

col <- aggregate(totalticks ~ plot  + site + year, data=full, FUN=sum)

ggplot(data = col,
       aes(x = site, y = totalticks,
           fill = plot))+
  facet_wrap(~year)+
  geom_bar(stat = 'summary', fun.y = 'mean')+
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  theme_classic()+
  xlab('Site') + ylab('Total ticks')+
  ggtitle('Total tick abundance by site and plot')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))
```


**Total ticks ~ Temperature**
  
```{r}
 col <- aggregate(totalticks ~ plot  + site + year + maxF + minF, data=full, FUN=sum)


ggplot(col, aes(x = maxF, y = totalticks, color = site))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  facet_wrap(~ year, scale = 'free_y')+
  labs(x = 'Mean maximum temperature (F)', y = 'Total ticks', color = 'Site')

ggplot(col, aes(x = minF, y = totalticks, color = site))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  facet_wrap(~ year, scale = 'free_y')+
  labs(x = 'Mean minimum temperature (F)', y = 'Total ticks', color = 'Site')

# no facet wrap
ggplot(col, aes(x = maxF, y = totalticks, color = site))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  labs(x = 'Mean maximum temperature (F)', y = 'Total ticks', color = 'Site')

ggplot(col, aes(x = minF, y = totalticks, color = site))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  labs(x = 'Mean minimum temperature (F)', y = 'Total ticks', color = 'Site')

# no color by site
ggplot(col, aes(x = maxF, y = totalticks))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  labs(x = 'Max  temperature (F)', y = 'Total ticks', color = 'Site')+
  ylim(0, 125)


ggplot(col, aes(x = minF, y = totalticks))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  labs(x = 'Min  temperature (F)', y = 'Total ticks', color = 'Site')+
  ylim(0, 125)



col <- aggregate(totalticks ~ plot  + site + year + diff, data=full, FUN=sum)

ggplot(col, aes(x = diff, y = totalticks, color = site))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  facet_wrap(~ year, scale = 'free_y')+
  labs(x = 'Difference between min/max temperature (F)', y = 'Total ticks')

# no facet wrap
ggplot(col, aes(x = diff, y = totalticks, color = site))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  labs(x = 'Difference between min/max  temperature (F)', y = 'Total ticks', color = 'Site')+
  ylim(0, 125)


ggplot(col, aes(x = diff, y = totalticks))+
  geom_point()+
  stat_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme_bw() +
  labs(x = 'Difference between min/max  temperature (F)', y = 'Total ticks', color = 'Site')+
  ylim(0, 125)



```


**Total ticks ~ Precipitation**

```{r}

# milimeters
col <- aggregate(totalticks ~ plot  + site + year + precip_mm, data=full, FUN=sum)


# no facet wrap
col <- col[which(col$precip_mm != 'NA'),]

ggplot(col, aes(x = log(precip_mm), y = totalticks, color = site))+
  geom_jitter(size = 2, alpha = .5, width = .2)+
  theme_bw() +
  geom_smooth(method = 'lm', se = FALSE, alpha = .7)+
  labs(x = 'log(Total precipitation (mm))', y = 'Total ticks', color = 'Site') +
  xtitletheme + ytitletheme



col <- col[which(col$precip_mm != 'NA'),]
ggplot(col, aes(x = log(precip_mm), y = totalticks))+
  geom_jitter(size = 3, alpha = .5, aes(color = site))+
  theme_bw() +
  geom_smooth(method = 'lm',  alpha = .7, aes(weight = totalticks, ymin = ifelse(..ymin.. < 0, 0, ..ymin..)))+
  labs(x = 'log(Total precipitation (mm))', y = 'Total ticks', color = 'Site')+
  ylim(0, 175) +
  xtitletheme + ytitletheme

# not log

ggplot(col, aes(x = precip_mm, y = totalticks))+
  geom_jitter(size = 3, alpha = .5, aes(color = site))+
  theme_bw() +
  geom_smooth(method = 'lm',  alpha = .7, aes(weight = totalticks, ymin = ifelse(..ymin.. < 0, 0, ..ymin..)))+
  labs(x = 'Total precipitation (mm)', y = 'Total ticks', color = 'Site')+
  ylim(0, 175) +
  xtitletheme + ytitletheme


# inches
col <- aggregate(totalticks ~ plot  + site + year + precip_in, data=full, FUN=sum)
ggplot(col, aes(x = log(precip_in), y = totalticks))+
  geom_jitter(size = 3, alpha = .5, aes(color = site))+
  theme_bw() +
  geom_smooth(method = 'lm',  alpha = .7, aes(weight = totalticks, ymin = ifelse(..ymin.. < 0, 0, ..ymin..)))+
  labs(x = 'log(Total precipitation (in))', y = 'Total ticks', color = 'Site')+
  ylim(0, 175) +
  xtitletheme + ytitletheme

# not log
col <- aggregate(totalticks ~ plot  + site + year + precip_in, data=full, FUN=sum)
ggplot(col, aes(x = precip_in, y = totalticks))+
  geom_jitter(size = 3, alpha = .5, aes(color = site))+
  theme_bw() +
  geom_smooth(method = 'lm',  alpha = .7, aes(weight = totalticks, ymin = ifelse(..ymin.. < 0, 0, ..ymin..)))+
  labs(x = 'Total precipitation (in)', y = 'Total ticks', color = 'Site')+
  ylim(0, 175) +
  xtitletheme + ytitletheme


```



# Mammals

Full mammal dataset

```{r}
# full dataset
mammals <- read.csv("~/Desktop/tejon_tickmammal_09032020.csv")


mammals <- subset(mammals, select = -c(16:28))


names(mammals)[12] <- "totalmammals"

```



Numeric dataset to calculate shannon diversity and species richness 

```{r}

# numeric dataframe for community analysis
Count <- read.csv("~/Desktop/tejon_mammalcount_09032020.csv", header = TRUE)

# remove the arid with NAs, this will be the full dataset with species richenss and diversity added
count <- Count[-4,]

# keep only numeric data to run community analyses
numeric <- count[,c(-1,-2,-9,-10)]

# organize data into right forms
count$plot <- factor(count$plot, 
                        levels = c('open','partial','total'))


# calculate mammal species richness
sppr <- specnumber(numeric)

# calculate mamal shannon diversity
shannondiv <- diversity(numeric)

# add species richness to count
count$sppr<-specnumber(numeric)

# add shannon diversity to count
count$shannondiv <- diversity(numeric)

pal <- c('darkseagreen1','darkseagreen3','darkseagreen4')
plotcolor <- pal

#View(count)
```


**Total mammals ~ Plot ID**

```{r}
col <- aggregate(totalmammals ~ plotID  + site + year, data=mammals, FUN=sum)

ggplot(col, aes(x = plotID, y = totalmammals, fill = site))+
  geom_boxplot()+
  geom_point()+
  theme_bw() +
  rotatexaxistheme+
  labs(x = 'Plot ID', y = 'Total mammals (2018-9)', fill = 'Site') +
  xtitletheme + ytitletheme

  

 col <- aggregate(totalmammals ~ plotID  + site + year, data=mammals, FUN=sum)

ggplot(col, aes(x = plotID, y = totalmammals, fill = site))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  facet_wrap(~ year, scale = 'free_y')+
  rotatexaxistheme+
  labs(x = 'Plot ID', y = 'Total mammals', fill = 'Site')+
  xtitletheme + ytitletheme
```


**Total mammals ~ Plot**
```{r}

col <- aggregate(totalmammals ~ plot  + site, data=mammals, FUN=sum)

ggplot(col, aes(x = plot, y = totalmammals), group = site)+
  geom_histogram(stat = 'identity', aes(fill = site))+
  theme_bw() +
  labs(x = 'Plot', y = 'Total mammals (2018-9)', fill = 'Site') +
    scale_fill_manual(values =c('red4','red3','red'))+
  xtitletheme + ytitletheme
```


**Total mammals ~ Site**
```{r}
col <- aggregate(totalmammals ~ plot  + site, data=mammals, FUN=sum)

ggplot(col, aes(x = site, y = totalmammals, fill = plot))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  labs(x = 'Site', y = 'Total mammals (2018-9)', fill = 'Plot') +
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  xtitletheme + ytitletheme 

```


**Mammal richness ~ Plot**

```{r}

 col <- aggregate(sppr ~ plot  + site, data=count, FUN=sum)

ggplot(col, aes(x = plot, y = sppr, fill = site))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  labs(x = 'Plot', y = 'Mammal richness (2018-9)', fill = 'Site') +
  scale_fill_manual(values =c('red4','red3','red'))+
  xtitletheme + ytitletheme
```

**Mammal richness ~ Site**
```{r}

 col <- aggregate(sppr ~ plot  + site, data=count, FUN=sum)


ggplot(col, aes(x = site, y = sppr, fill = plot))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  labs(x = 'Site', y = 'Mammal richness (2018-9)', fill = 'Plot') +
    scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  xtitletheme + ytitletheme


```


**Shannon diversity ~ Plot**
```{r}
 col <- aggregate(shannondiv ~ plot  + site, data=count, FUN=sum)

ggplot(col, aes(x = plot, y = shannondiv, fill = site))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  labs(x = 'Plot', y = 'Shannon diversity (2018-9)', fill = 'Site') +
  scale_fill_manual(values =c('red4','red3','red'))+
  xtitletheme + ytitletheme
```

**Shannon diversity ~ Site**
```{r}
 col <- aggregate(shannondiv ~ plot  + site, data=count, FUN=sum)

ggplot(col, aes(x = site, y = shannondiv, fill = plot))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  labs(x = 'Site', y = 'Shannon diversity (2018-9)', fill = 'Site') +
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  xtitletheme + ytitletheme
```




# Environmental data (rain and temperature)


**Precipitation ~ Site (fill with Plot)**

+ split into individual years
+ split into months

```{r}
# histograms
 col <- aggregate(precip_mm ~ plot  + site + year , data=full, FUN=sum)


ggplot(col, aes(x = site, y = precip_mm, fill = plot))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  facet_wrap(~ year)+
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  labs(x = 'Site', y = 'Precipitation (mm)', fill = 'Plot')+
  xtitletheme + ytitletheme


col <- aggregate(precip_mm ~ plot  + site + month , data=full, FUN=sum)


ggplot(col, aes(x = site, y = precip_mm, fill = plot))+
  geom_histogram(stat = 'identity')+
  theme_bw() +
  facet_wrap(~ month)+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = .69))+
  labs(x = 'Site', y = 'Precipitation (mm)', fill = 'Plot')+
  scale_fill_manual(values =c('darkseagreen1', 'darkseagreen3','darkseagreen4'))+
  xtitletheme + ytitletheme


```


**Temperature ~ Site**

+ split into months
```{r}

full <- full[which(full$site != 'NA'),]
ggplot(full, aes(x = site, y = maxF))+
  geom_violin(aes(fill = site), trim = FALSE, scale = 'count', adjust = .7, draw_quantiles = c(0.25, 0.5, 0.75))+
  #geom_boxplot(notch = TRUE)+
  #geom_jitter(alpha = .5, width = .2) +
  theme_bw() +
  labs(x = 'Site', y = 'Max Temperature (F)', fill = 'Plot')+
  xtitletheme + ytitletheme+
  guides(fill  = FALSE)

ggplot(full, aes(x = site, y = minF))+
  geom_violin(aes(fill = site), trim = FALSE, scale = 'count', adjust = .7, draw_quantiles = c(0.25, 0.5, 0.75))+
  #geom_boxplot(notch = TRUE)+
  #geom_jitter(alpha = .5, width = .2) +
  theme_bw() +
  labs(x = 'Site', y = 'Min Temperature (F)', fill = 'Plot')+
  xtitletheme + ytitletheme+
  guides(fill  = FALSE)

ggplot(full, aes(x = site, y = diff))+
  geom_violin(aes(fill = site), trim = FALSE, scale = 'count', adjust = .7, draw_quantiles = c(0.25, 0.5, 0.75))+
  #geom_jitter(alpha = .5, width = .2) +
  theme_bw() +
  labs(x = 'Site', y = 'Difference in min/max temperature (F)', fill = 'Plot')+
  xtitletheme + ytitletheme+
  guides(fill  = FALSE)

ggplot(full, aes(x = site, y = diff))+
  #geom_violin(aes(fill = site), trim = FALSE, scale = 'count', adjust = .5, draw_quantiles = c(0.25, 0.5, 0.75))+
  geom_boxplot(aes(fill = site))+
  #geom_jitter(alpha = .5, width = .2) +
  theme_bw() +
  facet_wrap(~ month)+
  labs(x = 'Site', y = 'Difference in min/max temperature (F)', fill = 'Plot')+
  xtitletheme + ytitletheme+
  guides(fill  = FALSE)


```

